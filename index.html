<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Navigator AI - Asistente de Estudio Inteligente</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base y Tipograf√≠a */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a7bfe8 0%, #619afb 100%); /* Tonos m√°s suaves y profesionales */
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        /* Contenedor Principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 40px);
        }

        /* Encabezado */
        .header {
            background: linear-gradient(45deg, #1f4068 0%, #162447 100%); /* Colores m√°s oscuros y serios */
            color: white;
            padding: 35px;
            text-align: center;
            border-bottom: 5px solid #0a1128;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Navegaci√≥n por Pesta√±as */
        .nav-tabs {
            display: flex;
            background: #e9f0f8; /* Fondo m√°s claro para las pesta√±as */
            border-bottom: 1px solid #d0dbe9;
        }

        .nav-tab {
            flex: 1;
            padding: 22px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.15rem;
            font-weight: 600;
            color: #5a6b82;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 4px;
            background: #1f4068; /* Color de la l√≠nea activa */
            transition: width 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #1f4068;
            font-weight: 700;
        }

        .nav-tab.active::after {
            width: 100%;
        }

        .nav-tab:hover:not(.active) {
            background: #dce4ed;
            color: #1f4068;
        }

        /* Contenido de Pesta√±as */
        .tab-content {
            display: none;
            padding: 40px;
            flex-grow: 1; /* Para que ocupe el espacio restante */
            animation: fadeIn 0.6s ease-out;
        }

        .tab-content.active {
            display: block;
            display: flex; /* Permite un layout interno flexible */
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Zonas de Carga (Upload) */
        .upload-zone {
            border: 3px dashed #c0ccda; /* Borde m√°s sutil */
            border-radius: 18px;
            padding: 60px;
            text-align: center;
            margin-bottom: 35px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fdfefe; /* Fondo casi blanco */
        }

        .upload-zone:hover {
            border-color: #1f4068;
            background: #f5f8fc;
        }

        .upload-zone.dragover {
            border-color: #1f4068;
            background: #eef2ff;
        }

        .upload-icon {
            font-size: 3.5rem;
            color: #8c9cb3;
            margin-bottom: 25px;
        }

        .upload-zone h3 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-zone p {
            font-size: 1.1rem;
            color: #666;
        }

        /* Botones */
        .btn {
            background: linear-gradient(45deg, #1f4068 0%, #162447 100%);
            color: white;
            padding: 14px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px 5px; /* M√°s espacio entre botones */
            box-shadow: 0 4px 15px rgba(31, 64, 104, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(31, 64, 104, 0.35);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c7a89 0%, #4a5a6a 100%);
            box-shadow: 0 4px 15px rgba(108, 122, 137, 0.2);
        }
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(108, 122, 137, 0.35);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
        }
        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.35);
        }

        /* Textarea */
        .textarea {
            width: 100%;
            min-height: 350px; /* Un poco m√°s grande */
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.05rem;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #333;
            background-color: #fdfefe;
        }

        .textarea:focus {
            outline: none;
            border-color: #1f4068;
            box-shadow: 0 0 0 4px rgba(31, 64, 104, 0.15);
        }

        /* Elementos de Materiales */
        .material-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .material-item:hover {
            border-color: #1f4068;
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            flex-wrap: wrap; /* Para responsividad */
            gap: 10px;
        }

        .material-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a2a3a;
        }

        .material-type {
            background: #1f4068;
            color: white;
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .material-content {
            color: #555;
            line-height: 1.7;
            margin-bottom: 18px;
        }

        .material-content p {
            margin-bottom: 8px;
        }

        /* Secci√≥n de An√°lisis */
        .analysis-section {
            background: #f8fbfc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #eef2f6;
        }

        .analysis-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a2a3a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .error-item {
            background: #fff0f0;
            border: 1px solid #fccdcd;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            color: #c0392b;
        }

        .error-type {
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .suggestion-item {
            background: #eefbff;
            border: 1px solid #bceeff;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            color: #0c729c;
        }

        .suggestion-type {
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        /* Grid de Estad√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: white;
            border-radius: 18px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #eff3f7;
        }

        .stat-card:hover {
            transform: translateY(-7px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: #1f4068;
            margin-bottom: 12px;
        }

        .stat-label {
            color: #666;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Elementos Auxiliares */
        .hidden {
            display: none;
        }

        .progress-bar {
            background: #e6eef5;
            border-radius: 12px;
            height: 22px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .progress-fill {
            background: linear-gradient(90deg, #1f4068, #162447);
            height: 100%;
            transition: width 0.4s ease;
            border-radius: 12px;
        }

        .ai-score {
            display: inline-block;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .ai-score.high {
            background: #d4edda;
            color: #28a745;
        }

        .ai-score.medium {
            background: #fff3cd;
            color: #ffc107;
        }

        .ai-score.low {
            background: #f8d7da;
            color: #dc3545;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #777;
            font-size: 1.2rem;
        }

        .spinner {
            border: 5px solid #f3f4f6;
            border-top: 5px solid #1f4068;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #888;
            background: #fcfdfe;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.03);
        }

        .empty-icon {
            font-size: 4.5rem;
            margin-bottom: 25px;
            opacity: 0.4;
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #555;
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* Estilos para el select de materias */
        .select-wrapper {
            position: relative;
            flex: 1;
        }

        #subjectSelect {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.05rem;
            font-family: 'Inter', sans-serif;
            background-color: white;
            appearance: none; /* Eliminar estilo nativo del select */
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
        }

        #subjectSelect:focus {
            outline: none;
            border-color: #1f4068;
            box-shadow: 0 0 0 4px rgba(31, 64, 104, 0.15);
        }

        .select-wrapper::after {
            content: '‚ñº'; /* Flecha personalizada */
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
        }

        /* Input para a√±adir nueva categor√≠a */
        .new-subject-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* Estilo para el input de tipo file oculto */
        #fileInput {
            display: none;
        }

        /* Media Queries para Responsividad */
        @media (max-width: 900px) {
            .header h1 {
                font-size: 2.2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .nav-tab {
                font-size: 1rem;
                padding: 18px;
            }
            .tab-content {
                padding: 30px;
            }
            .upload-zone {
                padding: 40px;
            }
            .stat-number {
                font-size: 2.5rem;
            }
            .stat-label {
                font-size: 1rem;
            }
            .material-title {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            .nav-tab {
                border-bottom: 1px solid #d0dbe9; /* Separador en vista m√≥vil */
            }
            .nav-tab.active::after {
                width: 50%; /* M√°s peque√±o en m√≥vil */
            }
            .material-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .tab-content {
                padding: 20px;
            }
            .stats-grid {
                grid-template-columns: 1fr; /* Una columna en m√≥vil */
            }
            .btn {
                width: 100%; /* Botones a ancho completo */
                margin: 8px 0;
            }
            .select-wrapper {
                margin-bottom: 15px; /* Espacio extra para el select */
            }
            #reportControls {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .container {
                border-radius: 10px;
            }
            .header {
                padding: 25px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .upload-zone {
                padding: 30px;
            }
            .upload-icon {
                font-size: 2.5rem;
            }
            .upload-zone h3 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Academic Navigator AI</h1>
            <p>Tu asistente inteligente para gestionar y potenciar tu aprendizaje universitario. Sube, organiza y analiza tu material de estudio con IA.</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="materials">üìö Mis Materias</button>
            <button class="nav-tab" data-tab="reports">üìù Generar Informes</button>
            <button class="nav-tab" data-tab="analysis">üîç An√°lisis Avanzado</button>
        </div>

        <div id="materials" class="tab-content active">
            <div class="upload-zone" id="materialUploadZone">
                <div class="upload-icon">üìÅ</div>
                <h3>Arrastra tus archivos aqu√≠ o haz clic para subir</h3>
                <p>Formatos soportados: PDF, DOCX, TXT, MD, JPG, PNG (para im√°genes)</p>
                <input type="file" id="fileInput" multiple accept=".pdf,.docx,.txt,.md,.jpg,.jpeg,.png">
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalMaterials">0</div>
                    <div class="stat-label">Documentos Subidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalWords">0</div>
                    <div class="stat-label">Palabras Analizadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSubjects">0</div>
                    <div class="stat-label">Categor√≠as Creadas</div>
                </div>
            </div>

            <div class="analysis-title">üìÇ Materiales Organizados por Categor√≠a</div>
            <div id="materialsList">
                <div class="empty-state">
                    <div class="empty-icon">üìö</div>
                    <h3>A√∫n no tienes materiales. ¬°Comienza a subir!</h3>
                    <p>Sube tus primeros documentos de estudio para que Academic Navigator AI los organice por ti.</p>
                </div>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px; flex-wrap: wrap;">
                <div class="select-wrapper">
                    <select id="subjectSelect">
                        <option value="">Selecciona una categor√≠a de estudio</option>
                        <option value="new-subject">‚ûï A√±adir nueva categor√≠a...</option>
                    </select>
                </div>
                <button class="btn" onclick="generateReport()">ü§ñ Generar Informe IA</button>
            </div>
            
            <div id="newSubjectInputContainer" class="hidden" style="margin-bottom: 25px;">
                <input type="text" id="newSubjectName" class="new-subject-input" placeholder="Nombre de la nueva categor√≠a (ej: 'Matem√°ticas Avanzadas')" onkeydown="if(event.key === 'Enter') addCustomSubject()">
                <button class="btn btn-secondary" style="margin-left: 10px; margin-top: 0;" onclick="addCustomSubject()">‚úÖ A√±adir</button>
            </div>

            <textarea id="reportText" class="textarea" placeholder="Tu informe se generar√° aqu√≠. Tambi√©n puedes escribirlo o pegarlo para analizarlo..."></textarea>
            
            <div id="reportControls" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button class="btn" onclick="analyzeReport()">üîç Analizar Informe Completo</button>
                <button class="btn btn-secondary" onclick="checkGrammar()">‚úèÔ∏è Revisi√≥n Ortogr√°fica y Gramatical</button>
                <button class="btn btn-secondary" onclick="improveReport()">‚ö° Mejorar Estilo y Coherencia</button>
                <button class="btn btn-secondary" onclick="addImagesToReport()">üñºÔ∏è Insertar Im√°genes</button>
                <button class="btn btn-secondary" onclick="exportReport()">üíæ Exportar Informe</button>
            </div>
        </div>

        <div id="analysis" class="tab-content">
            <div id="analysisContent">
                <div class="empty-state">
                    <div class="empty-icon">üìà</div>
                    <h3>No hay an√°lisis para mostrar.</h3>
                    <p>Genera o pega un informe en la pesta√±a "Generar Informes" y haz clic en "Analizar Informe Completo" para ver los resultados.</p>
                </div>
            </div>
            <div id="loadingAnalysis" class="loading hidden">
                <div class="spinner"></div>
                <p>Analizando tu informe con IA... Esto puede tomar un momento.</p>
            </div>
        </div>
    </div>

    <script>
        // *** Estado Global de la Aplicaci√≥n (Simulado para Frontend) ***
        let appState = {
            materials: [], // Almacenar√° metadatos de los materiales
            currentReport: '',
            lastAnalysis: null,
            subjects: new Set(), // Conjunto de categor√≠as
            // URL base de tu futuro backend API
            backendUrl: 'http://127.0.0.1:5000' // ¬°Importante! Cambia esto por la URL de tu servidor real
        };

        // *** Inicializaci√≥n al Cargar el DOM ***
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadInitialData(); // Cargar datos si existen (simulado por ahora)
            updateStats();
            updateSubjectSelect();
            // Mostrar la primera pesta√±a por defecto
            showTab('materials'); 
        });

        // *** Gesti√≥n de Event Listeners ***
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadZone = document.getElementById('materialUploadZone');
            const navTabs = document.querySelector('.nav-tabs');
            const subjectSelect = document.getElementById('subjectSelect');

            // Event listener para el input de archivo (oculto)
            fileInput.addEventListener('change', handleFileUpload);
            
            // Event listeners para Drag & Drop en la zona de carga
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                handleFileUpload({ target: { files: e.dataTransfer.files } });
            });
            // Click en la zona de carga para abrir el di√°logo de archivos
            uploadZone.addEventListener('click', () => {
                fileInput.click();
            });

            // Event listener para los botones de navegaci√≥n
            navTabs.addEventListener('click', (e) => {
                if (e.target.classList.contains('nav-tab')) {
                    showTab(e.target.dataset.tab);
                }
            });

            // Event listener para el cambio en el selector de materias
            subjectSelect.addEventListener('change', (e) => {
                if (e.target.value === 'new-subject') {
                    document.getElementById('newSubjectInputContainer').classList.remove('hidden');
                    document.getElementById('newSubjectName').focus();
                } else {
                    document.getElementById('newSubjectInputContainer').classList.add('hidden');
                }
            });
        }

        // *** Funciones de Navegaci√≥n entre Pesta√±as ***
        function showTab(tabName) {
            // Ocultar todas las pesta√±as de contenido y desactivar botones
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar la pesta√±a seleccionada y activar su bot√≥n
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.nav-tab[data-tab="${tabName}"]`).classList.add('active');
        }

        // *** Carga y Gesti√≥n de Archivos (Simulaci√≥n/Preparaci√≥n para Backend) ***
        async function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            // Mostrar un estado de carga global o por archivo si es posible
            console.log(`Subiendo ${files.length} archivo(s)...`);
            // Aqu√≠ en una implementaci√≥n real, mostrar√≠as un spinner o una barra de progreso.
            // Por simplicidad, solo registro en consola y hago una simulaci√≥n de carga.

            // Simulaci√≥n de subida para el frontend (el backend lo manejar√° de verdad)
            for (const file of files) {
                // Validaci√≥n b√°sica de tama√±o en frontend (puedes ajustar el l√≠mite)
                const MAX_FILE_SIZE_MB = 100; // Ejemplo: 100 MB por archivo en el frontend. El backend puede tener un l√≠mite mayor.
                if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) {
                    alert(`El archivo "${file.name}" excede el tama√±o m√°ximo permitido de ${MAX_FILE_SIZE_MB}MB. Por favor, sube archivos m√°s peque√±os.`);
                    continue; // Pasa al siguiente archivo
                }

                const reader = new FileReader();
                reader.onloadend = async function(e) {
                    const contentPreview = e.target.result.substring(0, 5000); // Solo una previsualizaci√≥n
                    const wordCount = contentPreview.split(/\s+/).filter(word => word.length > 0).length;

                    const material = {
                        id: Date.now() + Math.random(), // ID temporal
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        // En la implementaci√≥n real, `content` no se almacenar√≠a aqu√≠, sino que se enviar√≠a al backend
                        // y el backend guardar√≠a el archivo o lo procesar√≠a.
                        // Aqu√≠ solo para simular la vista previa.
                        contentPreview: contentPreview, 
                        wordCount: wordCount, // Esto ser√° m√°s preciso desde el backend
                        uploadDate: new Date().toLocaleString(),
                        subject: 'Pendiente de Asignar' // Se asignar√° o inferir√° por el backend
                    };
                    
                    appState.materials.push(material);
                    // No a√±adir a appState.subjects aqu√≠ directamente. 
                    // El backend se encargar√° de clasificar y retornar las categor√≠as.
                    updateMaterialsList();
                    updateStats();
                    updateSubjectSelect(); // Actualizar el selector por si acaso
                };
                // Leer como texto para previsualizaci√≥n, si es un tipo de texto
                if (file.type.startsWith('text/') || file.name.endsWith('.md') || file.name.endsWith('.docx') || file.name.endsWith('.pdf')) {
                    reader.readAsText(file);
                } else if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file); // Para im√°genes, leer como URL de datos para previsualizaci√≥n
                } else {
                    // Para otros tipos, no leer el contenido directamente en el frontend
                    console.warn(`Tipo de archivo no compatible para previsualizaci√≥n en el frontend: ${file.type}`);
                    // Simular un material b√°sico sin contenido preview
                    appState.materials.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        contentPreview: `Archivo binario o no textual: ${file.type}`,
                        wordCount: 0,
                        uploadDate: new Date().toLocaleString(),
                        subject: 'Pendiente de Asignar'
                    });
                    updateMaterialsList();
                    updateStats();
                    updateSubjectSelect();
                }

                // *** ESTO SER√çA EL PASO CLAVE PARA EL BACKEND REAL ***
                // Comentar o eliminar esta secci√≥n en el frontend si no tienes backend
                // const formData = new FormData();
                // formData.append('file', file);
                // formData.append('fileName', file.name);

                // try {
                //     // Aqu√≠ enviar√≠as el archivo al backend
                //     const response = await fetch(`${appState.backendUrl}/upload-material`, {
                //         method: 'POST',
                //         body: formData
                //     });
                //     if (!response.ok) {
                //         throw new Error(`Error en la subida: ${response.statusText}`);
                //     }
                //     const result = await response.json();
                //     console.log('Archivo subido y procesado por el backend:', result);
                //     // Actualizar el estado del material con la info del backend (categor√≠a, wordCount real, etc.)
                //     // result.materialData contendr√≠a id, name, type, size, contentPreview, wordCount, uploadDate, subject
                //     // appState.materials = appState.materials.filter(m => m.id !== material.id); // Eliminar la simulaci√≥n
                //     // appState.materials.push(result.materialData);
                //     // appState.subjects.add(result.materialData.subject);
                //     // updateMaterialsList();
                //     // updateStats();
                //     // updateSubjectSelect();
                // } catch (error) {
                //     console.error('Fallo al subir el archivo:', error);
                //     alert(`No se pudo subir "${file.name}". Int√©ntalo de nuevo. Error: ${error.message}`);
                //     // Opcional: Eliminar material simulado si fall√≥ la subida real
                //     // appState.materials = appState.materials.filter(m => m.id !== material.id);
                //     // updateMaterialsList();
                //     // updateStats();
                // }
            }
        }

        function extractSubject(filename) {
            // Esta funci√≥n se mover√° en gran parte al backend para una clasificaci√≥n m√°s inteligente
            const name = filename.toLowerCase().replace(/\.[^/.]+$/, "");
            
            const commonKeywords = {
                'matematicas': 'Matem√°ticas', 'fisica': 'F√≠sica', 'quimica': 'Qu√≠mica', 
                'biologia': 'Biolog√≠a', 'historia': 'Historia', 'literatura': 'Literatura', 
                'filosofia': 'Filosof√≠a', 'economia': 'Econom√≠a', 'derecho': 'Derecho', 
                'psicologia': 'Psicolog√≠a', 'ingles': 'Ingl√©s', 'espa√±ol': 'Espa√±ol', 
                'programacion': 'Programaci√≥n', 'informatica': 'Inform√°tica', 'estadistica': 'Estad√≠stica',
                'calculo': 'Matem√°ticas', 'algebra': 'Matem√°ticas', 'geometria': 'Matem√°ticas',
                'circuitos': 'F√≠sica', 'termondinamica': 'F√≠sica', 'optica': 'F√≠sica',
                'organica': 'Qu√≠mica', 'inorganica': 'Qu√≠mica', 'bioquimica': 'Biolog√≠a',
                'sistemas': 'Inform√°tica', 'redes': 'Inform√°tica', 'bases de datos': 'Inform√°tica',
                'constitucion': 'Derecho', 'civil': 'Derecho', 'penal': 'Derecho',
                'psicoanalisis': 'Psicolog√≠a', 'cognitiva': 'Psicolog√≠a',
                'poesia': 'Literatura', 'novela': 'Literatura',
                'antigua': 'Historia', 'moderna': 'Historia',
                'microeconomia': 'Econom√≠a', 'macroeconomia': 'Econom√≠a'
            };
            
            for (let keyword in commonKeywords) {
                if (name.includes(keyword)) {
                    return commonKeywords[keyword];
                }
            }
            
            return 'General / No Clasificado';
        }

        // Funci√≥n para cargar datos iniciales (simulados)
        function loadInitialData() {
            // Esto es solo para que veas algo al inicio. En la realidad, cargar√≠as de la base de datos.
            appState.materials = [
                { id: 1, name: 'Introduccion a la Programacion.pdf', type: 'application/pdf', size: 1234567, contentPreview: 'Contenido de programaci√≥n...', wordCount: 15000, uploadDate: '01/07/2025, 10:00:00', subject: 'Programaci√≥n' },
                { id: 2, name: 'Fundamentos de Economia.docx', type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', size: 2345678, contentPreview: 'Principios econ√≥micos...', wordCount: 22000, uploadDate: '02/07/2025, 11:30:00', subject: 'Econom√≠a' },
                { id: 3, name: 'Historia Antigua - Roma.txt', type: 'text/plain', size: 345678, contentPreview: 'El Imperio Romano...', wordCount: 8000, uploadDate: '03/07/2025, 14:15:00', subject: 'Historia' }
            ];
            appState.materials.forEach(m => appState.subjects.add(m.subject));
            updateMaterialsList();
        }

        function updateMaterialsList() {
            const listContainer = document.getElementById('materialsList');
            
            if (appState.materials.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <h3>A√∫n no tienes materiales. ¬°Comienza a subir!</h3>
                        <p>Sube tus primeros documentos de estudio para que Academic Navigator AI los organice por ti.</p>
                    </div>
                `;
                return;
            }

            // Agrupar materiales por categor√≠a
            const materialsByCategory = {};
            appState.materials.forEach(material => {
                const subject = material.subject || 'Sin Categor√≠a';
                if (!materialsByCategory[subject]) {
                    materialsByCategory[subject] = [];
                }
                materialsByCategory[subject].push(material);
            });

            let htmlContent = '';
            for (const subject in materialsByCategory) {
                htmlContent += `
                    <div class="analysis-section">
                        <div class="analysis-title">‚ú® ${subject} (${materialsByCategory[subject].length} Documentos)</div>
                `;
                htmlContent += materialsByCategory[subject].map(material => {
                    let icon = 'üìÑ';
                    if (material.type.includes('pdf')) icon = ' ‡¶™‡¶ø‡¶°‡¶ø‡¶è‡¶´';
                    else if (material.type.includes('docx')) icon = ' üñ∫';
                    else if (material.type.includes('txt') || material.type.includes('md')) icon = ' üìù';
                    else if (material.type.includes('image')) icon = ' üñºÔ∏è';

                    return `
                        <div class="material-item">
                            <div class="material-header">
                                <div class="material-title">${icon} ${material.name}</div>
                                <div class="material-type">${material.subject}</div>
                            </div>
                            <div class="material-content">
                                <p><strong>Palabras:</strong> ${material.wordCount.toLocaleString()}</p>
                                <p><strong>Tama√±o:</strong> ${(material.size / (1024 * 1024)).toFixed(2)} MB</p>
                                <p><strong>Subido:</strong> ${material.uploadDate}</p>
                                <p><strong>Previsualizaci√≥n:</strong> ${material.contentPreview.substring(0, 200)}...</p>
                            </div>
                            <button class="btn btn-danger" onclick="removeMaterial(${material.id})">üóëÔ∏è Eliminar</button>
                        </div>
                    `;
                }).join('');
                htmlContent += `</div>`; // Cierra analysis-section
            }
            listContainer.innerHTML = htmlContent;
        }

        function updateStats() {
            document.getElementById('totalMaterials').textContent = appState.materials.length;
            document.getElementById('totalWords').textContent = appState.materials.reduce((sum, m) => sum + m.wordCount, 0).toLocaleString();
            document.getElementById('totalSubjects').textContent = appState.subjects.size;
        }

        function updateSubjectSelect() {
            const select = document.getElementById('subjectSelect');
            // Guardar la opci√≥n "A√±adir nueva categor√≠a"
            const newSubjectOption = select.querySelector('option[value="new-subject"]');
            select.innerHTML = '<option value="">Selecciona una categor√≠a de estudio</option>';
            
            // Ordenar las categor√≠as alfab√©ticamente
            const sortedSubjects = Array.from(appState.subjects).sort();

            sortedSubjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                select.appendChild(option);
            });
            // Reinsertar la opci√≥n "A√±adir nueva categor√≠a" al final
            if (newSubjectOption) {
                select.appendChild(newSubjectOption);
            } else {
                const option = document.createElement('option');
                option.value = 'new-subject';
                option.textContent = '‚ûï A√±adir nueva categor√≠a...';
                select.appendChild(option);
            }
        }

        function addCustomSubject() {
            const newSubjectNameInput = document.getElementById('newSubjectName');
            const newSubjectName = newSubjectNameInput.value.trim();

            if (newSubjectName && !appState.subjects.has(newSubjectName)) {
                appState.subjects.add(newSubjectName);
                updateSubjectSelect();
                document.getElementById('subjectSelect').value = newSubjectName; // Seleccionar la nueva categor√≠a
                newSubjectNameInput.value = ''; // Limpiar el input
                document.getElementById('newSubjectInputContainer').classList.add('hidden');
            } else if (appState.subjects.has(newSubjectName)) {
                alert('Esa categor√≠a ya existe.');
            } else {
                alert('Por favor, ingresa un nombre para la nueva categor√≠a.');
            }
        }

        function removeMaterial(id) {
            appState.materials = appState.materials.filter(m => m.id !== id);
            // Reconstruir el set de subjects basado en los materiales restantes
            appState.subjects = new Set(appState.materials.map(m => m.subject).filter(s => s)); // Filtrar undefined/null
            updateMaterialsList();
            updateStats();
            updateSubjectSelect();
        }

        // *** Funciones de Informes y An√°lisis (Preparaci√≥n para Backend) ***
        async function generateReport() {
            const selectedSubject = document.getElementById('subjectSelect').value;
            if (!selectedSubject || selectedSubject === 'new-subject') {
                alert('Por favor, selecciona una categor√≠a v√°lida para generar el informe.');
                return;
            }
            
            // Aqu√≠, en una implementaci√≥n real, enviar√≠as la solicitud al backend
            // El backend buscar√≠a los materiales de esa materia y generar√≠a el informe.
            // Para la simulaci√≥n, uso los materiales del frontend.
            const relevantMaterials = appState.materials.filter(m => m.subject === selectedSubject);
            
            if (relevantMaterials.length === 0) {
                alert('No hay materiales asociados a esta categor√≠a para generar un informe.');
                return;
            }
            
            // Simular generaci√≥n de informe con IA (esto ser√≠a un llamado al backend)
            document.getElementById('reportText').value = "Generando informe... por favor espera.";
            // Simular una peque√±a demora de red
            await new Promise(resolve => setTimeout(resolve, 1500)); 
            
            const reportContent = generateReportContent(relevantMaterials);
            document.getElementById('reportText').value = reportContent;
            appState.currentReport = reportContent;

            alert('Informe generado con √©xito. ¬°Rev√≠salo y mejora con el an√°lisis IA!');

            // En un escenario real:
            // try {
            //     const response = await fetch(`${appState.backendUrl}/generate-report`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ subject: selectedSubject })
            //     });
            //     if (!response.ok) throw new Error('No se pudo generar el informe.');
            //     const data = await response.json();
            //     document.getElementById('reportText').value = data.reportContent;
            //     appState.currentReport = data.reportContent;
            // } catch (error) {
            //     console.error('Error al generar informe:', error);
            //     alert('Hubo un error al generar el informe. Int√©ntalo de nuevo.');
            //     document.getElementById('reportText').value = "Error al generar el informe.";
            // }
        }

        // Funci√≥n simulada para generar contenido de informe (ser√≠a manejada por el backend)
        function generateReportContent(materials) {
            const subject = materials[0].subject;
            const totalWords = materials.reduce((sum, m) => sum + m.wordCount, 0);
            
            return `# Informe Detallado de ${subject}

## Introducci√≥n y Alcance
Este informe ha sido compilado a partir de ${materials.length} documentos de estudio pertenecientes a la categor√≠a de **${subject}**, sumando un total aproximado de **${totalWords.toLocaleString()} palabras**. El objetivo es consolidar y presentar de manera estructurada los conceptos fundamentales y los puntos clave abordados en el material proporcionado.

## Desarrollo Tem√°tico y S√≠ntesis de Contenidos
${materials.map(m => `
### T√≠tulo del Documento: ${m.name.replace(/\.[^/.]+$/, "")}
* **Origen:** Material subido el ${m.uploadDate}.
* **Extracto Clave:** > ${m.contentPreview.substring(0, 400).split('\n').map(line => line.trim()).filter(line => line.length > 0).join(' ')}...
    
    Este segmento introduce los aspectos principales de "${m.name.replace(/\.[^/.]+$/, "")}", sentando las bases para una comprensi√≥n m√°s profunda. [Referencia: ${m.name}]
`).join('\n')}

## An√°lisis y Observaciones Clave
Basado en la integraci√≥n de los documentos, se observa que los conceptos de [Concepto 1] y [Concepto 2] son recurrentes y fundamentales. La interconexi√≥n entre [Tema A] y [Tema B] es vital para el dominio completo de la materia. Se sugiere una revisi√≥n especial de los [Ejemplos/Casos de Estudio] mencionados, ya que ilustran la aplicaci√≥n pr√°ctica de la teor√≠a.

## Conclusiones y Recomendaciones
Los materiales analizados ofrecen una visi√≥n integral de **${subject}**. Para una comprensi√≥n exhaustiva, se recomienda:
1.  Profundizar en la conceptualizaci√≥n de [Concepto Sugerido para Profundizar].
2.  Realizar ejercicios pr√°cticos que involucren [Habilidad Pr√°ctica Sugerida].
3.  Consultar fuentes adicionales sobre [Tema Espec√≠fico] para una perspectiva ampliada.

## Referencias Bibliogr√°ficas Generadas (Formato APA 7ma Edici√≥n)
${materials.map(m => `- ${m.name.replace(/\.[^/.]+$/, "")}. (${new Date(m.uploadDate).getFullYear()}). *[Tipo de Material, ej: Gu√≠a de Estudio/Apuntes]*. Recuperado de tus archivos personales.`).join('\n')}

---
*Informe generado autom√°ticamente por Academic Navigator AI el ${new Date().toLocaleString()}.*
*Este es un borrador inicial y requiere tu revisi√≥n y personalizaci√≥n para lograr la m√°xima calidad acad√©mica.*`;
        }

        async function analyzeReport() {
            const reportText = document.getElementById('reportText').value;
            if (!reportText.trim()) {
                alert('Por favor, escribe o genera un informe en la pesta√±a "Generar Informes" antes de analizarlo.');
                return;
            }
            
            // Mostrar estado de carga y cambiar a la pesta√±a de an√°lisis
            showTab('analysis');
            document.getElementById('analysisContent').innerHTML = ''; // Limpiar contenido anterior
            document.getElementById('loadingAnalysis').classList.remove('hidden');

            // En un escenario real, esto ser√≠a una llamada al backend
            // try {
            //     const response = await fetch(`${appState.backendUrl}/analyze-report`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ reportContent: reportText })
            //     });
            //     if (!response.ok) throw new Error('Error al analizar el informe.');
            //     const analysisResult = await response.json();
            //     appState.lastAnalysis = analysisResult;
            //     displayAnalysis(analysisResult);
            // } catch (error) {
            //     console.error('Fallo al analizar el informe:', error);
            //     document.getElementById('analysisContent').innerHTML = `<div class="error-item">Error al realizar el an√°lisis: ${error.message}. Por favor, int√©ntalo de nuevo.</div>`;
            // } finally {
            //     document.getElementById('loadingAnalysis').classList.add('hidden');
            // }

            // Simulaci√≥n de an√°lisis para el frontend (reemplazar con llamada a backend)
            await new Promise(resolve => setTimeout(resolve, 3000)); // Simula tiempo de procesamiento
            const analysisResult = performSimulatedAnalysis(reportText); // Usar funci√≥n simulada
            appState.lastAnalysis = analysisResult;
            displayAnalysis(analysisResult);
            document.getElementById('loadingAnalysis').classList.add('hidden');
        }

        // Funci√≥n simulada de an√°lisis (¬°ESTO DEBE SER IMPLEMENTADO EN EL BACKEND CON IA REAL!)
        function performSimulatedAnalysis(text) {
            const words = text.split(/\s+/).filter(w => w.length > 0);
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            
            // Simulaci√≥n de detecci√≥n de IA (muy b√°sica, el backend usar√≠a modelos ML)
            let aiScore = Math.floor(Math.random() * 100); // Aleatorio para simular
            let aiSuggestion = '';
            if (aiScore > 70) {
                aiSuggestion = 'Tu informe parece tener un alto nivel de contenido generado por IA. Para reducir esto, intenta reescribir secciones con tus propias palabras, a√±ade ejemplos personales o detalles espec√≠ficos que no se encuentren f√°cilmente online, y utiliza tu estilo de escritura √∫nico. Evita copiar y pegar directamente.';
            } else if (aiScore > 40) {
                aiSuggestion = 'El informe tiene algunas caracter√≠sticas de contenido generado por IA. Revisa las frases gen√©ricas o repetitivas, y busca oportunidades para inyectar m√°s originalidad y profundidad en tus argumentos. Incorpora m√°s tu voz personal.';
            } else {
                aiSuggestion = 'El contenido de tu informe muestra originalidad. ¬°Excelente trabajo! Contin√∫a desarrollando tu estilo √∫nico.';
            }

            // Simulaci√≥n de detecci√≥n de "planicie" (falta de profundidad/ejemplos)
            let flatnessSuggestion = '';
            if (words.length < 500 && paragraphs.length < 5) {
                flatnessSuggestion = 'Tu informe se siente un poco plano. Considera expandir tus ideas, a√±adir m√°s detalles, ejemplos concretos, estudios de caso o argumentos de soporte. Profundiza en los conceptos clave y ofrece tu propia perspectiva.';
            } else if (text.split('por ejemplo').length < 2 && text.split('en contraste').length < 2) {
                flatnessSuggestion = 'Para enriquecer tu informe, podr√≠as incluir m√°s ejemplos, analog√≠as o comparaciones para ilustrar tus puntos. La diversificaci√≥n de las fuentes y perspectivas tambi√©n ayuda a dar mayor profundidad.';
            } else {
                flatnessSuggestion = 'Tu informe presenta una buena profundidad. ¬°Sigue as√≠!';
            }

            // An√°lisis de legibilidad simulado (Flesch-Kincaid simplificado)
            const avgWordsPerSentence = words.length / (sentences.length || 1);
            const avgSentencesPerParagraph = sentences.length / (paragraphs.length || 1);
            
            let readabilityScore = 100 - (avgWordsPerSentence * 2) - (avgSentencesPerParagraph * 3);
            readabilityScore = Math.max(0, Math.min(100, Math.floor(readabilityScore)));
            
            // Errores y sugerencias b√°sicas (el backend har√≠a esto con NLP avanzado)
            const commonErrors = [
                { word: 'hice', correct: 'hice (ej. "Yo hice") o hice (ej. "Ella hizo")', type: 'Gram√°tica' },
                { word: 'valla', correct: 'valla (cerca), vaya (ir), baya (fruto)', type: 'Ortograf√≠a/Uso' },
                { word: 'm√°s o menos', correct: 'm√°s o menos (siempre separado)', type: 'Estilo' },
                { word: 'etc...', correct: 'etc. (sin puntos suspensivos)', type: 'Estilo' }
            ];
            
            const errors = [];
            commonErrors.forEach(error => {
                if (text.toLowerCase().includes(error.word)) {
                    errors.push(error);
                }
            });

            const suggestions = [];
            if (readabilityScore < 60) {
                suggestions.push({
                    type: 'Claridad',
                    suggestion: 'Tu texto podr√≠a ser m√°s f√°cil de leer. Intenta usar oraciones m√°s cortas y directas, y vocabulario m√°s accesible.'
                });
            }
            if (paragraphs.length < 5 && words.length > 300) {
                suggestions.push({
                    type: 'Estructura',
                    suggestion: 'Considera dividir p√°rrafos muy largos para mejorar el flujo de lectura y la organizaci√≥n.'
                });
            }
            if (!text.toLowerCase().includes('bibliograf√≠a') && !text.toLowerCase().includes('referencias')) {
                suggestions.push({
                    type: 'Acad√©mico',
                    suggestion: 'Es crucial incluir una secci√≥n de referencias o bibliograf√≠a al final de tu informe para dar cr√©dito a las fuentes y apoyar tus argumentos.'
                });
            }
            if (!text.toLowerCase().includes('introducci√≥n') && words.length > 500) {
                suggestions.push({
                    type: 'Estructura',
                    suggestion: 'Aseg√∫rate de tener una introducci√≥n clara que presente el tema y el prop√≥sito del informe.'
                });
            }
            if (!text.toLowerCase().includes('conclusi√≥n') && words.length > 500) {
                suggestions.push({
                    type: 'Estructura',
                    suggestion: 'Una conclusi√≥n efectiva resume los puntos clave y ofrece una perspectiva final o implicaciones.'
                });
            }
            
            return {
                wordCount: words.length,
                sentenceCount: sentences.length,
                paragraphCount: paragraphs.length,
                readabilityScore: readabilityScore,
                avgWordsPerSentence: Math.round(avgWordsPerSentence),
                avgSentencesPerParagraph: Math.round(avgSentencesPerParagraph * 10) / 10,
                aiDetection: { score: aiScore, suggestion: aiSuggestion },
                flatnessDetection: { suggestion: flatnessSuggestion },
                errors: errors,
                suggestions: suggestions
            };
        }

        function displayAnalysis(analysis) {
            let scoreClass = 'low';
            if (analysis.readabilityScore >= 70) scoreClass = 'high';
            else if (analysis.readabilityScore >= 50) scoreClass = 'medium';

            let aiScoreClass = 'high'; // Por defecto si no hay an√°lisis o es bajo
            if (analysis.aiDetection.score <= 30) aiScoreClass = 'high';
            else if (analysis.aiDetection.score <= 70) aiScoreClass = 'medium';
            else aiScoreClass = 'low'; // Alto nivel de IA -> Bajo en originalidad

            document.getElementById('analysisContent').innerHTML = `
                <div class="analysis-section">
                    <div class="analysis-title">üìä Visi√≥n General del Informe</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${analysis.wordCount.toLocaleString()}</div>
                            <div class="stat-label">Palabras Totales</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${analysis.sentenceCount}</div>
                            <div class="stat-label">Oraciones</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${analysis.paragraphCount}</div>
                            <div class="stat-label">P√°rrafos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${analysis.avgWordsPerSentence}</div>
                            <div class="stat-label">Palabras/Oraci√≥n</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">üéØ Puntuaci√≥n de Legibilidad</div>
                    <div class="ai-score ${scoreClass}">${analysis.readabilityScore}/100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.readabilityScore}%"></div>
                    </div>
                    <p style="color: #555;">Una puntuaci√≥n alta indica que tu texto es f√°cil de comprender. Si es baja, considera simplificar oraciones y vocabulario.</p>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">ü§ñ Detecci√≥n de Contenido IA</div>
                    <div class="ai-score ${aiScoreClass}">Nivel IA: ${analysis.aiDetection.score}%</div>
                    <p style="color: #555;">${analysis.aiDetection.suggestion}</p>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">‚ú® Sugerencias de Profundidad</div>
                    <p style="color: #555;">${analysis.flatnessDetection.suggestion}</p>
                </div>
                
                ${analysis.errors.length > 0 ? `
                <div class="analysis-section">
                    <div class="analysis-title">‚ùå Errores y Puntos a Corregir</div>
                    ${analysis.errors.map(error => `
                        <div class="error-item">
                            <div class="error-type">${error.type}</div>
                            <div>Se encontr√≥: "${error.word}" ‚Üí Sugerencia: "${error.correct}"</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${analysis.suggestions.length > 0 ? `
                <div class="analysis-section">
                    <div class="analysis-title">üí° Sugerencias de Mejora Adicional</div>
                    ${analysis.suggestions.map(suggestion => `
                        <div class="suggestion-item">
                            <div class="suggestion-type">${suggestion.type}</div>
                            <div>${suggestion.suggestion}</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;
        }

        async function checkGrammar() {
            const text = document.getElementById('reportText').value;
            if (!text.trim()) {
                alert('Por favor, escribe algo para revisar la ortograf√≠a y gram√°tica.');
                return;
            }
            
            alert('Activando revisi√≥n. En un sistema real, esto enviar√≠a el texto a un servicio de correcci√≥n avanzado (ej. LanguageTool API, o un modelo NLP propio en el backend) y mostrar√≠a las correcciones directamente en el texto o como sugerencias.');
            // Ejemplo para backend:
            // try {
            //     const response = await fetch(`${appState.backendUrl}/check-grammar`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ text: text })
            //     });
            //     const result = await response.json();
            //     // Aqu√≠ actualizar√≠as el textarea con el texto corregido o mostrar√≠as las sugerencias
            //     console.log('Correcciones:', result.corrections);
            //     alert('Revisi√≥n completada. Consulta la consola para ver las correcciones (o implementa una UI m√°s visual).');
            // } catch (error) {
            //     console.error('Error al revisar gram√°tica:', error);
            //     alert('Hubo un error al revisar la gram√°tica. Int√©ntalo de nuevo.');
            // }
        }

        async function improveReport() {
            const text = document.getElementById('reportText').value;
            if (!text.trim()) {
                alert('Por favor, escribe algo para mejorar el contenido.');
                return;
            }
            
            alert('Mejorando el informe con IA... Esto tomar√° un momento. En un sistema real, el backend reescribir√≠a y expandir√≠a el texto.');
            document.getElementById('reportText').value = "Mejorando el contenido, por favor espera...";

            // Simulaci√≥n de mejora (¬°Esto debe ser un modelo de lenguaje grande en el backend!)
            await new Promise(resolve => setTimeout(resolve, 3000));
            const improvedText = text + '\n\n### Secci√≥n Expandida y Mejorada por Academic Navigator AI\n\nEsta parte del informe ha sido enriquecida para aumentar la profundidad, la coherencia y la claridad. Se han a√±adido detalles, ejemplos hipot√©ticos y se ha refinado la estructura para una lectura m√°s fluida. Recuerda personalizar y validar esta mejora con tu propio conocimiento.\n\n* **Clarificaci√≥n de Conceptos:** Se han desglosado t√©rminos complejos para facilitar la comprensi√≥n.\n* **Ampliaci√≥n de Argumentos:** Se han desarrollado ideas principales con mayor detalle y soporte.\n* **Mejora de Transiciones:** Las conexiones entre p√°rrafos y secciones son ahora m√°s fluidas.\n\n*Recuerda que este es un punto de partida avanzado, pero tu toque personal es indispensable.*';
            
            document.getElementById('reportText').value = improvedText;
            alert('¬°Informe mejorado significativamente! Revisa las adiciones y ajusta a tus necesidades.');

            // En un escenario real:
            // try {
            //     const response = await fetch(`${appState.backendUrl}/improve-report`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ reportContent: text })
            //     });
            //     if (!response.ok) throw new Error('No se pudo mejorar el informe.');
            //     const data = await response.json();
            //     document.getElementById('reportText').value = data.improvedContent;
            //     alert('Informe mejorado con √©xito. Revisa el nuevo contenido.');
            // } catch (error) {
            //     console.error('Error al mejorar informe:', error);
            //     alert('Hubo un error al mejorar el informe. Int√©ntalo de nuevo.');
            //     document.getElementById('reportText').value = "Error al mejorar el informe.";
            // }
        }

        async function addImagesToReport() {
            alert('Esta funci√≥n es para el backend. En una implementaci√≥n real, aqu√≠ se abrir√≠a un di√°logo para seleccionar im√°genes ya subidas o para subir nuevas, y el bot las insertar√≠a en el informe con formato adecuado.');
            // Para un backend:
            // 1. Mostrar√≠a una interfaz para seleccionar im√°genes ya subidas o para subir nuevas.
            // 2. El usuario selecciona la imagen y posiblemente la posici√≥n.
            // 3. El backend procesa la imagen (redimensiona, optimiza, sube a un CDN/almac√©n).
            // 4. El backend o el frontend inserta una etiqueta <img> o un marcador de posici√≥n Markdown en el textarea.
            // Ejemplo: `![Descripci√≥n de la imagen](URL_de_la_imagen)`
            // alert('Funcionalidad de insertar im√°genes activada. En una implementaci√≥n real, aqu√≠ se gestionar√≠a la inserci√≥n de im√°genes desde tus materiales o nuevas subidas.');
        }


        function exportReport() {
            const text = document.getElementById('reportText').value;
            if (!text.trim()) {
                alert('No hay contenido en el informe para exportar.');
                return;
            }
            
            const filename = `Informe_AcademicNavigatorAI_${new Date().toISOString().slice(0,10)}.md`; // Formato Markdown sugerido
            const blob = new Blob([text], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            alert('Informe exportado como archivo Markdown (.md).');
        }

        // *** Otras Utilidades (Bibliograf√≠a APA 7ma Edici√≥n) ***
        // Esta funci√≥n ser√≠a parte del backend, que generar√≠a referencias APA de forma inteligente
        // a partir de los metadatos de los documentos.
        function generateAPA7Reference(material) {
            const year = new Date(material.uploadDate).getFullYear();
            const author = "Autor Desconocido"; // Necesitar√≠as extraer esto del contenido o metadatos
            const title = material.name.replace(/\.[^/.]+$/, "");
            const type = "Documento de estudio"; // Podr√≠a ser m√°s espec√≠fico (Libro, Art√≠culo, etc.)

            return `${author}. (${year}). *${title}*. [${type}]. Recuperado de tus archivos personales.`;
        }

    </script>
</body>
</html>
