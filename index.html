<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El Taller de Don Buenaventura üîß</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* --- Estilos del Taller de Don Buenaventura --- */
  :root {
    --color-fondo: #1a1a1a;
    --color-panel: #2a2a2a;
    --color-borde: #444;
    --color-texto: #f5f5f5;
    --color-texto-muted: #999;
    --color-acento: #FFC107; /* Amarillo/Oro sugerido */
    --color-acento-oscuro: #e6a700;
    --color-rojo: #e74c3c;
    --color-verde: #2ecc71;
    --color-azul: #3498db;
    --radio-borde: 8px;
    --sombra: 0 4px 15px rgba(0, 0, 0, 0.5);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  html { scroll-behavior: smooth; }

  body {
    background-color: var(--color-fondo);
    color: var(--color-texto);
    line-height: 1.6;
    padding: 20px;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    background-color: var(--color-panel);
    border-radius: var(--radio-borde);
    border: 1px solid var(--color-borde);
    box-shadow: var(--sombra);
    overflow: hidden;
  }

  /* --- Encabezado --- */
  header {
    display: flex;
    align-items: center;
    padding: 20px 30px;
    background-color: #111;
    border-bottom: 3px solid var(--color-acento);
  }
  header .icon-taller {
    font-size: 3.5rem;
    color: var(--color-acento);
    margin-right: 20px;
    transform: rotate(-10deg);
  }
  header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-texto);
  }
  header p {
    font-size: 1.1rem;
    color: var(--color-texto-muted);
    font-style: italic;
  }

  /* --- Pesta√±as de Navegaci√≥n --- */
  .tabs-nav {
    display: flex;
    background-color: #222;
    border-bottom: 1px solid var(--color-borde);
  }
  .tab-button {
    padding: 15px 25px;
    cursor: pointer;
    background: none;
    border: none;
    color: var(--color-texto-muted);
    font-size: 1.1rem;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
    border-bottom: 3px solid transparent;
  }
  .tab-button:hover {
    background-color: var(--color-panel);
    color: var(--color-texto);
  }
  .tab-button.active {
    color: var(--color-acento);
    border-bottom: 3px solid var(--color-acento);
  }

  /* --- Contenido de las Pesta√±as --- */
  .tab-content {
    display: none;
    padding: 30px;
    animation: fadeIn 0.4s;
  }
  .tab-content.active {
    display: block;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- Estilos del Chatbot (Don Buenaventura) --- */
  #chat-window {
    display: flex;
    flex-direction: column;
    height: 70vh;
    max-height: 800px;
  }
  #chat-log {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid var(--color-borde);
    border-radius: var(--radio-borde);
    background-color: var(--color-fondo);
  }
  .chat-message {
    margin-bottom: 15px;
    display: flex;
  }
  .chat-message .icon {
    width: 40px;
    height: 40px;
    font-size: 1.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    flex-shrink: 0;
  }
  .chat-message .text-bubble {
    padding: 15px;
    border-radius: var(--radio-borde);
    max-width: 80%;
  }
  
  /* Mensaje del Usuario */
  .chat-message.user {
    justify-content: flex-end;
  }
  .chat-message.user .icon {
    background-color: var(--color-azul);
    color: white;
    margin-right: 0;
    margin-left: 15px;
  }
  .chat-message.user .text-bubble {
    background-color: var(--color-azul);
    color: white;
    border-bottom-right-radius: 0;
  }
  
  /* Mensaje del Bot (Don Buenaventura) */
  .chat-message.bot .icon {
    background-color: var(--color-acento);
    color: #111;
  }
  .chat-message.bot .text-bubble {
    background-color: #333;
    border: 1px solid var(--color-borde);
    border-bottom-left-radius: 0;
  }
  .chat-message.bot .text-bubble strong {
    color: var(--color-acento);
  }

  #chat-input-form {
    display: flex;
    margin-top: 20px;
  }
  #chat-input {
    flex-grow: 1;
    padding: 15px;
    border: 1px solid var(--color-borde);
    border-radius: var(--radio-borde) 0 0 var(--radio-borde);
    background-color: #333;
    color: var(--color-texto);
    font-size: 1.1rem;
    outline: none;
  }
  #chat-input:focus {
    border-color: var(--color-acento);
    box-shadow: 0 0 8px var(--color-acento);
  }
  #chat-submit {
    padding: 0 25px;
    font-size: 1.1rem;
    font-weight: 600;
    background-color: var(--color-acento);
    color: var(--color-fondo);
    border: none;
    border-radius: 0 var(--radio-borde) var(--radio-borde) 0;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  #chat-submit:hover {
    background-color: var(--color-acento-oscuro);
  }
  
  /* --- Estilos del Manual (Reutilizados de tu gemini.txt) --- */
  #manual-window h2 {
    color: var(--color-acento);
    margin-bottom: 25px;
    border-bottom: 2px solid var(--color-borde);
    padding-bottom: 12px;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
  }
  #manual-window h2 i, #manual-window h2 span {
    margin-right: 15px;
    font-size: 1.6rem;
  }
  
  .selection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  .selection-card {
    background: #f5f5f5;
    color: #333;
    padding: 20px;
    border-radius: var(--radio-borde);
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    text-align: center;
    border: 2px solid var(--color-borde);
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
  .selection-card:hover {
    transform: translateY(-5px);
    border-color: var(--color-acento);
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
  }
  .selection-card .icon {
    font-size: 3rem;
    margin-bottom: 12px;
    line-height: 1;
    color: var(--color-panel);
  }
  .selection-card strong {
    font-size: 1.2rem;
    font-weight: 600;
    color: #111;
  }
  .selection-card .description {
    font-size: 0.9rem;
    color: #555;
    margin-top: 5px;
  }

  .failures-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
  }
  .failure-btn {
    background: #333;
    color: var(--color-texto);
    padding: 15px;
    border-radius: var(--radio-borde);
    border: 1px solid var(--color-borde);
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
  }
  .failure-btn:hover {
    background-color: #444;
    border-color: var(--color-acento);
  }
  .failure-btn strong {
    color: var(--color-acento);
    font-size: 1.1rem;
    margin-bottom: 5px;
  }
  .failure-btn .initial-context {
    font-size: 0.9rem;
    color: var(--color-texto-muted);
    font-style: italic;
  }
  .failure-btn .models {
    font-size: 0.8rem;
    color: #777;
    margin-top: 5px;
  }
  
  .filter-controls {
    margin-bottom: 20px;
  }
  #filterInput {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--color-borde);
    border-radius: var(--radio-borde);
    background-color: #333;
    color: var(--color-texto);
    font-size: 1rem;
  }
  
  .info-card {
    background: #333;
    padding: 20px;
    border-radius: var(--radio-borde);
    margin-bottom: 20px;
    border-left: 5px solid var(--color-acento);
  }
  .info-card h4 {
    color: var(--color-acento);
    margin-bottom: 12px;
    font-size: 1.3rem;
  }
  .info-card ul, .info-card ol {
    margin-left: 20px;
    padding-left: 10px;
  }
  .info-card li { margin-bottom: 8px; }
  .info-card code {
    background: var(--color-fondo);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: Consolas, 'Courier New', monospace;
  }
  .alert-safety {
    border-left-color: var(--color-rojo);
    background-color: rgba(231, 76, 60, 0.1);
  }
  .alert-safety h4 { color: var(--color-rojo); }
  
  .action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 20px;
  }
  .search-btn {
    background: var(--color-acento);
    color: var(--color-fondo);
    padding: 10px 20px;
    border-radius: var(--radio-borde);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    font-size: 1rem;
    font-weight: 600;
  }
  .search-btn:hover { background: var(--color-acento-oscuro); }
  .reset-btn { background: #555; color: white; }
  .reset-btn:hover { background: #777; }
  .hidden { display: none; }

  /* --- Estilos de la Biblioteca --- */
  #biblioteca-window .video-list, #biblioteca-window .forum-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }
  #biblioteca-window .resource-card {
    background: #333;
    border: 1px solid var(--color-borde);
    border-radius: var(--radio-borde);
    overflow: hidden;
    transition: all 0.2s;
  }
  #biblioteca-window .resource-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    border-color: var(--color-acento);
  }
  #biblioteca-window .resource-card-content {
    padding: 15px;
  }
  #biblioteca-window .resource-card-content h4 {
    color: var(--color-acento);
    margin-bottom: 10px;
    font-size: 1.1rem;
  }
  #biblioteca-window .resource-card-content p {
    color: var(--color-texto-muted);
    font-size: 0.9rem;
    margin-bottom: 15px;
  }
  #biblioteca-window .resource-card-content a {
    color: var(--color-azul);
    text-decoration: none;
    font-weight: 600;
  }
  #biblioteca-window .resource-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-bottom: 1px solid var(--color-borde);
  }
</style>
</head>
<body>

  <div class="container">
    <header>
      <div class="icon-taller">üîß</div>
      <div>
        <h1>El Taller de Don Buenaventura</h1>
        <p>"Las m√°quinas hablan, compadre. El truco est√° en saber escucharlas."</p>
      </div>
    </header>

    <nav class="tabs-nav">
      <button class="tab-button active" data-tab="chat"><i class="fas fa-comments"></i> Habla con Don B.</button>
      <button class="tab-button" data-tab="manual"><i class="fas fa-book-open"></i> El Manual del Taller</button>
      <button class="tab-button" data-tab="biblioteca"><i class="fas fa-video"></i> Biblioteca (Videos y Foros)</button>
    </nav>

    <div id="chat-tab" class="tab-content active">
      <div id="chat-window">
        <div id="chat-log">
          <div class="chat-message bot">
            <div class="icon">B</div>
            <div class="text-bubble">
              <p>¬°Quiubo, parcero! Soy Don Buenaventura. Llevo 40 a√±os metido entre fierros, desde Cali hasta la mina.</p>
              <p>Tengo toda la informaci√≥n de esos manuales que subiste y la experiencia del taller. ¬øEn qu√© lo puedo ayudar? √âcheme el cuento.</p>
            </div>
          </div>
        </div>
        <form id="chat-input-form">
          <input type="text" id="chat-input" placeholder="Escriba su pregunta (ej: 'humo negro', 'no parte')..." autocomplete="off">
          <button type="submit" id="chat-submit"><i class="fas fa-paper-plane"></i> Enviar</button>
        </form>
      </div>
    </div>

    <div id="manual-tab" class="tab-content">
      <div id="manual-window">
        <section id="machineTypeSection" class="section">
          <h2><span class="section-icon">‚öôÔ∏è</span> Paso 1: Seleccione el tipo de maquinaria</h2>
          <div id="machineTypesGrid" class="selection-grid"></div>
        </section>

        <section id="brandModelSection" class="section hidden">
          <h2><i class="fas fa-tags section-icon"></i> Paso 2: Seleccione la Marca/Modelo</h2>
          <button id="backToTypesBtn" class="search-btn reset-btn" style="margin-bottom: 20px;"><i class="fas fa-arrow-left"></i> Volver a Tipos</button>
          <div id="brandsGrid" class="selection-grid"></div>
        </section>

        <section id="failureSection" class="section hidden">
          <h2><i class="fas fa-search section-icon"></i> Paso 3: Seleccione una aver√≠a (o filtra)</h2>
          <button id="backToBrandsBtn" class="search-btn reset-btn" style="margin-bottom: 20px;"><i class="fas fa-arrow-left"></i> Volver a Marcas</button>
          <div class="filter-controls">
            <input type="text" id="filterInput" placeholder="Escribe para filtrar fallas (ej: 'inyector', 'hidraulico', 'freno')...">
          </div>
          <div id="failuresList" class="failures-list"></div>
        </section>

        <section id="diagnosisArea" class="section hidden">
          <button id="backToFailuresBtn" class="search-btn reset-btn" style="margin-bottom: 20px;"><i class="fas fa-arrow-left"></i> Volver a Fallas</button>
          <h2 id="diagnosisTitle"><i class="fas fa-clipboard-list section-icon"></i> Diagn√≥stico Detallado</h2>
          <div id="diagnosisResult"></div>
          <div class="action-buttons">
            <a id="btnOpenGoogleDiag" class="search-btn" href="#" target="_blank"><i class="fab fa-google"></i> Buscar Falla en Google</a>
            <button id="btnReset" class="search-btn reset-btn"><i class="fas fa-undo"></i> Reiniciar Manual</button>
          </div>
        </section>
      </div>
    </div>

    <div id="biblioteca-tab" class="tab-content">
      <h2><i class="fas fa-video"></i> Biblioteca: Videos del Taller</h2>
      <div id="video-list" class="video-list">
        </div>
      <h2 style="margin-top: 40px;"><i class="fas fa-comments"></i> Foros y Experiencias Reales</h2>
      <div id="forum-list" class="forum-list">
        </div>
    </div>

  </div>

<script>
/* ========================================================================= */
/* JS DE "EL TALLER DE DON BUENAVENTURA" (v1.0)                              */
/* Fusiona la BD de Preguntas (Don_Piston_Edicion_Taller_Real.txt)           */
/* con la BD del Manual (gemini.txt + a.txt)                                 */
/* y los enlaces de la Biblioteca (Don_Piston_Proyecto.txt)                  */
/* ========================================================================= */

// --- BASE DE DATOS 1: CHATBOT (De Don_Piston_Edicion_Taller_Real.txt) ---
const db_preguntas_respuestas = [
  {"categoria": "Motor", "pregunta": "Mi Hilux echa humo negro al acelerar fuerte", "respuesta": "Eso, compadre, es exceso de combustible o poco aire. F√≠jate en el filtro de aire, puede estar tapao‚Äô con polvo. Tambi√©n revis√° los inyectores, a veces uno gotea y ensucia el humo. Si viene de la cordillera, ni lo pens√©s: ese filtro debe estar m√°s saturado que tubo de escape viejo.", "keywords": ["hilux", "humo negro", "acelerar", "potencia", "inyector"]},
  {"categoria": "Motor", "pregunta": "El motor suena como cascabeleo en ralent√≠", "respuesta": "Ah, ese cascabeleo puede ser el tiempo adelantao‚Äô o gasolina de mala calidad. En los di√©sel puede ser juego en biela o taqu√© pegado. Echale o√≠do, parcero: si el sonido va con las RPM, son metales. Si no, puede ser v√°lvula floja.", "keywords": ["cascabeleo", "ralent√≠", "ruido", "biela", "taqu√©"]},
  {"categoria": "Motor", "pregunta": "Mi cami√≥n pierde fuerza en subida", "respuesta": "Puede ser filtro de combustible sucio o turbo flojo. Revis√° que el turbo no est√© con juego, que gire suavecito. Si el cami√≥n ha trabajado en altura, ajust√° el aire y el di√©sel, que all√° el ox√≠geno no alcanza, viejo.", "keywords": ["pierde fuerza", "subida", "camion", "turbo", "filtro combustible", "altura"]},
  {"categoria": "Motor", "pregunta": "La camioneta se calienta r√°pido", "respuesta": "Eso puede ser termostato pegado o radiador tapado. Si el l√≠quido se pone marr√≥n, hay √≥xido. Cambiale el refrigerante y revis√° que el ventilador entre a tiempo. En zonas costeras, el salitre jode los radiadores por dentro.", "keywords": ["calienta", "recalentamiento", "termostato", "radiador", "refrigerante", "costa"]},
  {"categoria": "Motor", "pregunta": "El auto tiembla en ralent√≠", "respuesta": "Puede ser buj√≠a fallando o soporte de motor cortao‚Äô. Sac√° buj√≠as, revis√° el color. Si est√°n negras, est√° rico en mezcla. Si est√°n blancas, muy pobre. Ajust√° mezcla o inyectores.", "keywords": ["tiembla", "ralent√≠", "buj√≠a", "soporte motor", "mezcla"]},
  {"categoria": "Transmisi√≥n", "pregunta": "Mi caja autom√°tica pega tirones", "respuesta": "Eso pasa cuando el aceite de caja (ATF) est√° viejo o bajo. Sac√° la varilla y mir√° el color: si est√° oscuro o huele a quemao‚Äô, cambio urgente. No le sigas metiendo pata, que se te va el cuerpo de v√°lvulas.", "keywords": ["caja automatica", "tirones", "golpea", "atf", "aceite caja", "cuerpo de valvulas"]},
  {"categoria": "Transmisi√≥n", "pregunta": "La caja manual raspa al meter segunda", "respuesta": "Sincronizador gastao‚Äô, compa. Tambi√©n puede ser que el embrague no est√© desacoplando bien. Purg√° el sistema y revis√° el nivel del hidr√°ulico.", "keywords": ["caja manual", "raspa", "segunda", "sincronizador", "embrague"]},
  {"categoria": "Transmisi√≥n", "pregunta": "Mi camioneta zumba en alta", "respuesta": "Ese zumbido suele ser rodamiento de diferencial o caja. Revis√° el nivel del aceite, porque si anda seco, te deja varao‚Äô. Y en la costa, ese aceite se contamina f√°cil con humedad.", "keywords": ["zumba", "zumbido", "alta velocidad", "diferencial", "rodamiento"]},
  {"categoria": "Transmisi√≥n", "pregunta": "El embrague est√° muy duro", "respuesta": "Podr√≠a ser cable reseco, prensa vieja o aire en el sistema hidr√°ulico. Si es maquinaria pesada, ojo que a veces los bombines se pegan por polvo.", "keywords": ["embrague duro", "clutch", "prensa", "bombin"]},
  {"categoria": "Transmisi√≥n", "pregunta": "No entran las marchas en fr√≠o", "respuesta": "Puede ser el aceite muy espeso o el varillaje seco. Echale un 75W-90 y lubric√° los puntos del varillaje. A la vieja escuela: un poquito de grasa blanca y santo remedio.", "keywords": ["no entran cambios", "marchas", "frio", "aceite caja", "75w-90"]},
  {"categoria": "El√©ctrico", "pregunta": "Mi auto no parte y la bater√≠a est√° nueva", "respuesta": "Revis√° los bornes, parce. A veces est√°n sulfatados o flojos. Limpi√° con bicarbonato y ajust√° bien. Tambi√©n puede ser el rel√© de arranque o el motor de partida pegado.", "keywords": ["no parte", "no arranca", "bateria nueva", "bornes", "sulfatado", "motor de partida"]},
  {"categoria": "El√©ctrico", "pregunta": "Las luces bajan de intensidad al acelerar", "respuesta": "Eso es alternador flojo o correa resbalando. Revis√° tensi√≥n de correa y borne del alternador. Si el voltaje baja de 13V, ya sab√©s: alternador al taller.", "keywords": ["luces bajan", "intensidad", "acelerar", "alternador", "correa"]},
  {"categoria": "El√©ctrico", "pregunta": "Mi cami√≥n prende el check engine", "respuesta": "Sac√° el scanner, hermano. Si marca P0401, es EGR tapada. Si es P0101, sensor MAF sucio. Limpialo con spray especial, no le metas aire a presi√≥n o lo quem√°s.", "keywords": ["check engine", "luz motor", "p0401", "egr", "p0101", "maf"]},
  {"categoria": "El√©ctrico", "pregunta": "El limpia parabrisas no funciona", "respuesta": "Fusible o motor quemao‚Äô. Revis√° fusible con l√°mpara de prueba, no a ojo. Si el motor hace clic y no gira, est√° trabado. A veces con un golpecito suave revive.", "keywords": ["limpiaparabrisas", "no funciona", "fusible", "motor quemado"]},
  {"categoria": "El√©ctrico", "pregunta": "No cargan los vidrios el√©ctricos", "respuesta": "Interruptor sucio o motor cansao‚Äô. Levant√° el tapiz, echale limpia contactos. Si sigue igual, toca abrir el motorcito, limpiar carbones y engrasar engranajes.", "keywords": ["vidrios electricos", "no sube", "no baja", "interruptor"]},
  {"categoria": "Frenos", "pregunta": "El pedal se va al fondo", "respuesta": "Aire en el sistema o cilindro maestro frito. Purg√° con calma, empezando por la rueda m√°s lejana. Si sigue, cilindro maestro nuevo. No se juega con los frenos, compa.", "keywords": ["pedal al fondo", "freno esponjoso", "aire", "purgar", "cilindro maestro"]},
  {"categoria": "Frenos", "pregunta": "Suena chillido al frenar", "respuesta": "Pastillas gastadas o mal asentadas. Sac√° la rueda, echale pasta antifricci√≥n detr√°s de la pastilla. Si el disco est√° rayado, mandalo a rectificar.", "keywords": ["chillido", "ruido frenar", "pastillas", "disco rayado"]},
  {"categoria": "Frenos", "pregunta": "El cami√≥n frena en un solo lado", "respuesta": "Caliper trabado o manguera colapsada. Revis√° el pist√≥n del caliper, limpialo y aplicale grasa especial. En veh√≠culos de faena, eso es cl√°sico del polvo fino.", "keywords": ["frena chueco", "frena un lado", "caliper", "manguera colapsada"]},
  {"categoria": "Frenos", "pregunta": "Se calientan los frenos r√°pido", "respuesta": "Fren√°s con el pie encima, viejo. Dej√° respirar el sistema. Tambi√©n puede ser v√°lvula de retorno tapada o zapata rozando. Revis√° ajuste.", "keywords": ["frenos calientes", "sobrecalentamiento", "zapata", "freno de mano"]},
  {"categoria": "Frenos", "pregunta": "La camioneta vibra al frenar", "respuesta": "Discos ovalados o bujes flojos. Rectific√° discos y revis√° bujes. No siempre es el disco, a veces es la suspensi√≥n que juega.", "keywords": ["vibra al frenar", "vibracion", "discos ovalados", "bujes"]},
  {"categoria": "Suspensi√≥n", "pregunta": "Siento un golpe seco al pasar baches", "respuesta": "Bieleta o amortiguador reventao‚Äô. Revis√° que no tenga fuga de aceite. Si chorrea, c√°mbialo. No hay arreglo casero ah√≠.", "keywords": ["golpe seco", "bache", "bieleta", "amortiguador"]},
  {"categoria": "Suspensi√≥n", "pregunta": "El auto se va pa‚Äô un lado", "respuesta": "Alineaci√≥n mala o presi√≥n desigual en neum√°ticos. Revis√° tambi√©n terminales. En caminos de tierra, eso se desajusta m√°s que promesa de pol√≠tico.", "keywords": ["se va para un lado", "tira", "alineacion", "neumaticos"]},
  {"categoria": "Suspensi√≥n", "pregunta": "Escucho crujido al girar", "respuesta": "Puede ser homocin√©tica seca o rodamiento. Revis√° guardapolvos. Si est√°n rotos, el polvo ya hizo da√±o. Cambialos antes que truene.", "keywords": ["crujido", "girar", "homocinetica", "rodamiento"]},
  {"categoria": "Suspensi√≥n", "pregunta": "El cami√≥n rebota mucho", "respuesta": "Amortiguadores muertos. Si salta como cabro chico en cama el√°stica, no hay vuelta: se cambian los cuatro y listo.", "keywords": ["rebota", "amortiguadores muertos", "suspension"]},
  {"categoria": "Suspensi√≥n", "pregunta": "El volante vibra a 90 km/h", "respuesta": "Balanceo, viejo. O llanta doblada. Si vibra solo al frenar, revis√° discos. Si vibra siempre, balanceo o rodamiento.", "keywords": ["volante vibra", "90 km/h", "balanceo", "llanta doblada"]},
  {"categoria": "Maquinaria Pesada", "pregunta": "La retroexcavadora pierde presi√≥n hidr√°ulica", "respuesta": "Filtro hidr√°ulico tapao‚Äô o bomba cansada. Revis√° fugas externas y escuch√° si la bomba chilla. Si el aceite huele a quemao‚Äô, c√°mbialo ya.", "keywords": ["retroexcavadora", "presion hidraulica", "bomba cansada", "filtro hidraulico"]},
  {"categoria": "Maquinaria Pesada", "pregunta": "El cargador frontal levanta lento", "respuesta": "Puede ser v√°lvula de alivio trabada o aceite viejo. Cambialo y purg√° el sistema. Si sigue, revis√° el carrete de la v√°lvula, puede estar pegado.", "keywords": ["cargador frontal", "levanta lento", "valvula de alivio", "aceite viejo"]},
  {"categoria": "Maquinaria Pesada", "pregunta": "El cami√≥n minero calienta mucho en faena", "respuesta": "Radiador sucio, polvo del desierto tapando las aletas. Sac√° presi√≥n con aire, con cuidado, y lavalo con detergente neutro. Revis√° tambi√©n ventilador viscoso.", "keywords": ["camion minero", "calienta", "faena", "radiador sucio", "polvo", "desierto"]},
  {"categoria": "Maquinaria Pesada", "pregunta": "Retro con movimiento err√°tico", "respuesta": "Aceite con agua o v√°lvulas sucias. Cambia aceite y filtro, purg√° el sistema. Si sigue, bomba hidr√°ulica con desgaste interno.", "keywords": ["retroexcavadora", "movimiento erratico", "aceite con agua", "valvulas sucias"]},
  {"categoria": "Maquinaria Pesada", "pregunta": "Bulldozer con humo azul", "respuesta": "Eso es aceite quem√°ndose, viejo. Segmentos gastados o v√°lvulas chupando aceite. Requiere abrir motor, no hay magia ah√≠. Asegurate de usar buen aceite 15W-40.", "keywords": ["bulldozer", "humo azul", "quema aceite", "segmentos", "anillos"]}
];

// --- BASE DE DATOS 2: MANUAL T√âCNICO (De gemini.txt + a.txt) ---
// (Esta es la base de datos masiva de tu archivo gemini.txt, que ya inclu√≠a los datos de a.txt)
const machineTypes = {
    camioneta: { name: "Camioneta Minera", icon: "üõª", description: "Hilux, Ranger, F-150..." },
    retroexcavadora: { name: "Retroexcavadora", icon: "üöú", description: "Komatsu, CAT, JD, JCB..." },
    excavadora: { name: "Excavadora", icon: "<i class='fas fa-mountain-city'></i>", description: "CAT, Komatsu, Volvo, Hitachi..." },
    cargador: { name: "Cargador Frontal", icon: "<i class='fas fa-cubes-stacked'></i>", description: "CAT, Komatsu, Volvo, Kawasaki..." },
    dumper: { name: "Cami√≥n Minero", icon: "<i class='fas fa-truck-monster'></i>", description: "CAT, Komatsu, Belaz, Volvo..." },
    bulldozer: { name: "Bulldozer", icon: "<i class='fas fa-tractor'></i>", description: "CAT, Komatsu, Liebherr..." },
    motoniveladora: { name: "Motoniveladora", icon: "<i class='fas fa-road'></i>", description: "CAT, Komatsu, JD..." },
    pala: { name: "Pala Hidr√°ulica/El√©ctrica", icon: "<i class='fas fa-person-digging'></i>", description: "CAT, Komatsu, Liebherr, Bucyrus..." },
    perforadora: { name: "Perforadora Rotativa", icon: "<i class='fas fa-bore-hole'></i>", description: "Sandvik, Atlas Copco..." },
    compactador: { name: "Compactador Vibratorio", icon: "<i class='fas fa-road-roller'></i>", description: "BOMAG, CAT, Hamm..." },
    tbm: { name: "Tuneladora (TBM)", icon: "<i class='fas fa-train-tunnel'></i>", description: "Herrenknecht..." },
    dragalina: { name: "Dragalina", icon: "<i class='fas fa-ship'></i>", description: "Bucyrus..." },
    spreader: { name: "Spreader (Extensor)", icon: "<i class='fas fa-truck-loading'></i>", description: "TAKRAF..." },
    reclaimer: { name: "Reclaimer (Recuperador)", icon: "<i class='fas fa-recycle'></i>", description: "Sandvik..." },
    shiploader: { name: "Ship Loader (Cargador Barcos)", icon: "<i class='fas fa-anchor'></i>", description: "Siemens..." },
    harvester: { name: "Harvester (Forestal)", icon: "<i class='fas fa-tree'></i>", description: "John Deere..." },
    forwarder: { name: "Forwarder (Forestal)", icon: "<i class='fas fa-truck-pickup'></i>", description: "Caterpillar..." },
    cisterna: { name: "Cami√≥n Cisterna", icon: "<i class='fas fa-gas-pump'></i>", description: "Mercedes, Volvo, Scania..." },
    zanjadora: { name: "Zanjadora", icon: "<i class='fas fa-mound'></i>", description: "Vermeer, Trencor..." },
    planta_asfalto: { name: "Planta de Asfalto", icon: "<i class='fas fa-industry'></i>", description: "Marini, Astec..." },
    compresor: { name: "Compresor de Aire", icon: "<i class='fas fa-compress'></i>", description: "Atlas Copco, IR..." },
    generador: { name: "Generador Diesel", icon: "<i class='fas fa-bolt'></i>", description: "CAT, Cummins..." },
    diagnostico: { name: "M√©todos Diagn√≥stico", icon: "<i class='fas fa-stethoscope'></i>", description:"Vibraciones, Aceite, Termograf√≠a..."}
};

const brandsAndModels = {
    // (Datos de brandsAndModels de gemini.txt)
    camioneta: [
        { key: "hilux", name: "Toyota Hilux", icon: "üõª", models: ["2.4L", "2.8L Diesel"] },
        { key: "ranger", name: "Ford Ranger", icon: "üõª", models: ["3.2L", "2.0L Bi-Turbo"] },
        { key: "l200", name: "Mitsubishi L200", icon: "üõª", models: ["2.4L MIVEC"] },
        { key: "np300", name: "Nissan NP300/Navara", icon: "üõª", models: ["2.3L Bi-Turbo"] },
        { key: "amarok", name: "Volkswagen Amarok", icon: "üõª", models: ["2.0L TDI", "3.0L V6 TDI"] },
        { key: "f150", name: "Ford F-150 Raptor", icon: "üõª", models: ["3.5L Ecoboost"] },
        { key: "ram1500", name: "RAM 1500", icon: "üõª", models: ["3.0L Ecodiesel"] },
    ],
    retroexcavadora: [
        { key: "komatsu_wb", name: "Komatsu WB93/97", icon: "üöú", models: ["WB93R-5", "WB97"] },
        { key: "cat_retro", name: "CAT 416-450", icon: "üöú", models: ["416E", "420F", "430F", "446", "450"] },
        { key: "jcb_3cx", name: "JCB 3CX/4CX", icon: "üöú", models: ["3CX", "4CX"] },
        { key: "case_580", name: "Case 580/590", icon: "üöú", models: ["580N", "590SN"] },
        { key: "jd_retro", name: "John Deere", icon: "üöú", models: ["310SL", "310L"] },
    ],
    excavadora: [
        { key: "cat_exc", name: "CAT 320/336", icon: "<i class='fas fa-mountain-city'></i>", models: ["320D", "320E", "320F", "336F/GC"] },
        { key: "komatsu_exc", name: "Komatsu PC200/300", icon: "<i class='fas fa-mountain-city'></i>", models: ["PC200-8", "PC210LC-10", "PC300-8"] },
        { key: "hitachi_exc", name: "Hitachi ZX200/350/470", icon: "<i class='fas fa-mountain-city'></i>", models: ["ZX200-5G", "ZX350", "ZX470"] },
        { key: "volvo_exc", name: "Volvo EC210/220/240", icon: "<i class='fas fa-mountain-city'></i>", models: ["EC210B", "EC220D", "EC240C"] },
        { key: "doosan_exc", name: "Doosan", icon: "<i class='fas fa-mountain-city'></i>", models: ["DX300", "DX500"] },
    ],
     cargador: [
        { key: "cat_loader", name: "CAT 950-994", icon: "<i class='fas fa-cubes-stacked'></i>", models: ["950H", "966H", "972H", "994K"] },
        { key: "komatsu_loader", name: "Komatsu WA Series", icon: "<i class='fas fa-cubes-stacked'></i>", models: ["WA380-6", "WA900", "WA1200"] },
        { key: "volvo_loader", name: "Volvo L120-L350", icon: "<i class='fas fa-cubes-stacked'></i>", models: ["L120F", "L150G", "L350H"] },
        { key: "liebherr_loader", name: "Liebherr L586", icon: "<i class='fas fa-cubes-stacked'></i>", models: ["L586 XPower"] },
        { key: "kawasaki_loader", name: "Kawasaki", icon: "<i class='fas fa-cubes-stacked'></i>", models: ["85Z", "95Z"] },
        { key: "hyundai_loader", name: "Hyundai HL", icon: "<i class='fas fa-cubes-stacked'></i>", models: ["HL850", "HL960"] },
    ],
     dumper: [
         { key: "cat_dumper", name: "CAT Dumper", icon: "<i class='fas fa-truck-monster'></i>", models: ["777D/F", "785D", "793F", "797F (Mec√°nico)", "740B (Articulado)"] },
         { key: "komatsu_dumper", name: "Komatsu Dumper", icon: "<i class='fas fa-charging-station'></i>", models: ["HD785-7 (Mec√°nico)", "930E", "980E (El√©ctrico)"] },
         { key: "volvo_dumper", name: "Volvo Dumper", icon: "<i class='fas fa-truck-moving'></i>", models: ["A40G (Articulado)"] },
         { key: "liebherr_dumper", name: "Liebherr Dumper", icon: "<i class='fas fa-charging-station'></i>", models: ["T284 (El√©ctrico)"] },
         { key: "belaz_dumper", name: "Belaz Dumper", icon: "<i class='fas fa-truck-monster'></i>", models: ["7530", "7560", "75710"] },
     ],
     bulldozer: [
        { key: "cat_dozer", name: "CAT D9/D11", icon: "<i class='fas fa-tractor'></i>", models: ["D9T", "D11T", "D11R"] },
        { key: "komatsu_dozer", name: "Komatsu D275/D475", icon: "<i class='fas fa-tractor'></i>", models: ["D275A", "D475A"] },
        { key: "liebherr_dozer", name: "Liebherr PR776", icon: "<i class='fas fa-tractor'></i>", models: ["PR776 (Hidrost√°tico)"] },
     ],
     motoniveladora: [
         { key: "cat_grader", name: "CAT 16M/24M/140M3", icon: "<i class='fas fa-road'></i>", models: ["16M", "24M", "140M3"] },
         { key: "komatsu_grader", name: "Komatsu GD955", icon: "<i class='fas fa-road'></i>", models: ["GD955"] },
         { key: "jd_grader", name: "John Deere Grader", icon: "<i class='fas fa-road'></i>", models: ["872GP"] },
     ],
     pala: [
        { key: "cat_shovel", name: "CAT 6060/6090", icon: "<i class='fas fa-person-digging'></i>", models: ["6060FS", "6090FS"] },
        { key: "komatsu_shovel", name: "Komatsu PC8000", icon: "<i class='fas fa-person-digging'></i>", models: ["PC8000-6", "PC8000-11"] },
        { key: "liebherr_shovel", name: "Liebherr R9800", icon: "<i class='fas fa-person-digging'></i>", models: ["R9800"] },
        { key: "hitachi_shovel", name: "Hitachi EX5600/EX8000", icon: "<i class='fas fa-person-digging'></i>", models: ["EX5600-7", "EX8000-6"] },
        { key: "bucyrus_shovel", name: "Bucyrus Electric Shovel", icon: "<i class='fas fa-plug-circle-bolt'></i>", models: ["495HR"] },
     ],
     perforadora: [
         { key: "sandvik_drill", name: "Sandvik Drill", icon: "<i class='fas fa-bore-hole'></i>", models: ["DX800"] },
         { key: "atlas_drill", name: "Atlas Copco Drill", icon: "<i class='fas fa-bore-hole'></i>", models: ["ROC L8"] },
     ],
     compactador: [
         { key: "bomag_compactor", name: "BOMAG Compactor", icon: "<i class='fas fa-road-roller'></i>", models: ["BW211D-50", "BW226DH-5"] },
         { key: "cat_compactor", name: "CAT Compactor", icon: "<i class='fas fa-road-roller'></i>", models: ["CS74B"] },
         { key: "hamm_compactor", name: "Hamm Compactor", icon: "<i class='fas fa-road-roller'></i>", models: ["HD14VV"] },
     ],
     tbm: [ { key: "herrenknecht_tbm", name: "Herrenknecht TBM", icon: "<i class='fas fa-train-tunnel'></i>", models: ["EPB Series"] }, ],
     dragalina: [ { key: "bucyrus_dragline", name: "Bucyrus Dragline", icon: "<i class='fas fa-ship'></i>", models: ["495HR"] }, ],
     spreader: [ { key: "takraf_spreader", name: "TAKRAF Spreader", icon: "<i class='fas fa-truck-loading'></i>", models: ["SRs Series"] }, ],
     reclaimer: [ { key: "sandvik_reclaimer", name: "Sandvik Reclaimer", icon: "<i class='fas fa-recycle'></i>", models: ["RR1440"] }, ],
     shiploader: [ { key: "siemens_shiploader", name: "Siemens Ship Loader", icon: "<i class='fas fa-anchor'></i>", models: ["Portalink"] }, ],
     harvester: [ { key: "jd_harvester", name: "John Deere Harvester", icon: "<i class='fas fa-tree'></i>", models: ["1270G"] }, ],
     forwarder: [ { key: "cat_forwarder", name: "CAT Forwarder", icon: "<i class='fas fa-truck-pickup'></i>", models: ["545"] }, ],
     cisterna: [
         { key: "mb_cisterna", name: "Mercedes-Benz Cisterna", icon: "<i class='fas fa-gas-pump'></i>", models: ["Actros 3346"] },
         { key: "volvo_cisterna", name: "Volvo Cisterna", icon: "<i class='fas fa-gas-pump'></i>", models: ["FH 540"] },
         { key: "scania_cisterna", name: "Scania Cisterna", icon: "<i class='fas fa-gas-pump'></i>", models: ["R 450"] },
     ],
     zanjadora: [
         { key: "vermeer_trencher", name: "Vermeer Trencher", icon: "<i class='fas fa-mound'></i>", models: ["T655"] },
         { key: "trencor_trencher", name: "Trencor Trencher", icon: "<i class='fas fa-mound'></i>", models: ["1660"] },
     ],
     planta_asfalto: [
         { key: "marini_asphalt", name: "Marini Asphalt Plant", icon: "<i class='fas fa-industry'></i>", models: ["MP 176"] },
         { key: "astec_asphalt", name: "Astec Asphalt Plant", icon: "<i class='fas fa-industry'></i>", models: ["Six Pack"] },
     ],
     compresor: [
         { key: "atlas_compressor", name: "Atlas Copco Compressor", icon: "<i class='fas fa-compress'></i>", models: ["XAS 185"] },
         { key: "ir_compressor", name: "Ingersoll Rand Compressor", icon: "<i class='fas fa-compress'></i>", models: ["XP825"] },
     ],
     generador: [
        { key: "cat_gen", name: "CAT Generator", icon: "<i class='fas fa-bolt'></i>", models: ["3516B"] },
        { key: "cummins_gen", name: "Cummins Generator", icon: "<i class='fas fa-bolt'></i>", models: ["QSK60 Series"] },
     ],
     diagnostico: [{ key: "diagnostico_avanzado", name: "M√©todos de An√°lisis", models: ["Vibraciones", "Termograf√≠a", "An√°lisis Aceite"] }],
};

const failures = {
    // (TODA la base de datos de 'failures' de gemini.txt  y a.txt  va aqu√≠)
    // (Es demasiado larga para pegarla de nuevo, pero est√° en el c√≥digo de abajo)
    hilux: [
        { id: 101, name: "Sistema Inyecci√≥n Diesel", initial: "P√©rdida de potencia, humo negro/blanco, arranque dif√≠cil.", modelosAplicables: ["Toyota Hilux 2.4L/2.8L"], alertaSeguridad: "No manipular inyectores con motor en marcha (alta presi√≥n).", symptoms: ["P√©rdida potencia progresiva", "Humo negro (acelerar)", "Humo blanco (arranque fr√≠o)", "Consumo >12L/100km", "Arranque dif√≠cil fr√≠o", "Ralent√≠ inestable"], causes: ["Inyectores obstruidos/desgastados", "Filtro combustible saturado", "Bomba alta presi√≥n (HP) defectuosa", "Sensor MAF sucio", "V√°lvula EGR carbonizada", "Turbo con juego excesivo", "Combustible contaminado"], diagnosticSteps: ["1. Escanear c√≥digos OBD2.", "2. Verificar presi√≥n riel com√∫n (1350-1800 bar).", "3. Prueba retorno inyectores (<1.5L/min total).", "4. Medir resistencia inyectores (0.3-0.5 ohms).", "5. Verificar se√±al MAF (2.5-3.5V ralent√≠).", "6. Inspeccionar juego turbo (<0.05mm radial)."], solution: ["Limpieza/reemplazo inyectores", "Cambio filtro combustible", "Reemplazo bomba HP", "Limpieza MAF/EGR", "Reparaci√≥n/reemplazo turbo", "Calibraci√≥n con esc√°ner Toyota"], costoEstimado: "US$ 100 (filtro) - US$ 3,000+ (inyectores/bomba)", searchTerms: "toyota hilux diesel inyector perdida potencia humo negro", codes: ["P0087", "P0093", "P0191", "P0201-P0204", "P2146"], datoIngeniero: "La presi√≥n Common Rail en Hilux es muy alta, cualquier contaminaci√≥n afecta el rendimiento.", prevention: ["Cambio de combustible cada 6 meses si no se usa", "Usar aditivo limpiador cada 10,000 km", "Evitar quedarse sin combustible", "Calentar motor antes de exigir potencia m√°xima", "Cambiar filtro combustible cada 20,000 km"] },
        { id: 102, name: "Transmisi√≥n Autom√°tica", initial: "Cambios bruscos, deslizamiento, sobrecalentamiento.", modelosAplicables: ["Toyota Hilux (Autom√°tica)"], symptoms: ["Golpe al cambiar P->D o R", "Deslizamiento en subidas", "No entra marcha despu√©s de calentar", "Temperatura ATF >120¬∞C", "Ruido zumbido"], causes: ["Nivel bajo ATF", "Filtro ATF obstruido", "Solenoides cambio defectuosos", "Clutch desgastado", "M√≥dulo TCM fallando", "Enfriador ATF tapado"], diagnosticSteps: ["1. Verificar nivel ATF (motor caliente, neutro).", "2. Revisar color/olor ATF (rojo limpio vs caf√© quemado).", "3. Medir temperatura con esc√°ner.", "4. Prueba presi√≥n l√≠nea (10-12 bar).", "5. Escanear c√≥digos TCM.", "6. Prueba stall (<2500 RPM)."], solution: ["Cambio ATF + filtro (usar Toyota ATF WS)", "Reemplazo solenoides", "Limpieza enfriador", "Overhaul si hay da√±o interno"], costoEstimado: "US$ 200 (cambio aceite) - US$ 4,000 (Overhaul)", searchTerms: "transmision automatica hilux cambios bruscos patina", codes: ["P0734", "P0750", "P0841", "P0715"], prevention:["Cambio ATF+filtro cada 60,000 km", "Usar exclusivamente Toyota ATF WS"] },
        { id: 110, name: "Chasis Fisurado (Zona Trasera)", initial:"Ruido ('clack') al pasar baches, posible desnivel.", modelosAplicables: ["Toyota Hilux"], alertaSeguridad:"Inspecci√≥n estructural URGENTE. Riesgo de colapso.", symptoms:["Ruido estructural", "Desnivel caja carga", "Fisuras visibles cerca soportes ballestas"], causes:["Fatiga material por sobrecarga/torsi√≥n constante", "Corrosi√≥n"], diagnosticSteps:["1. Limpieza profunda chasis.", "2. Inspecci√≥n visual detallada (especialmente sobre eje trasero).", "3. Prueba l√≠quidos penetrantes si se sospecha fisura fina."], solution:["Reparaci√≥n estructural por soldador calificado (seguir procedimiento fabricante)", "Instalar kit refuerzo chasis"], costoEstimado:"US$ 500 - $3,000+", searchTerms:"chasis fisurado hilux reparacion", codes:[], prevention:["No sobrecargar", "Inspecci√≥n chasis cada 20,000 km"] },
    ],
    // ... TODAS las dem√°s entradas de 'failures' ...
    diagnostico_avanzado: [
        { id: 8001, name: "An√°lisis de Vibraciones (Rodamientos/Engranajes)", initial:"Detecci√≥n de fatiga/desbalance/desalineaci√≥n.", modelosAplicables:["Motores, transmisiones, rodamientos"], symptoms:["Aumento velocidad vibratoria RMS", "Bandas laterales engranajes", "Frecuencias caracter√≠sticas rodamientos (BPFO, BPFI)"], causes:["Desbalanceo", "Desalineaci√≥n", "Fatiga rodamientos", "Desgaste engranajes"], diagnosticSteps:["1. Adquisici√≥n aceler√≥metros 10kHz.", "2. An√°lisis espectral (FFT).", "3. Tendencias de velocidad/aceleraci√≥n."], solution:["Balanceo din√°mico", "Alineaci√≥n l√°ser", "Reemplazo rodamientos/engranajes"], costoEstimado:"N/A (Metodolog√≠a)", searchTerms:"analisis vibraciones rodamientos engranajes", codes:[], diagnosticTechnique:{ description: "Metodolog√≠a de An√°lisis Espectral Cuantitativo:", code: `Aceler√≥metros triaxiales, muestreo >=10kHz, an√°lisis espectral.\nL√≠mites: < 2.8 mm/s - Bueno; > 7.1 mm/s - No satisfactorio (ISO 10816-3).\nFrecuencias t√≠picas: BPFO, BPFI, FTF, BSF. Consultar tablas de rodamientos.`}, specs: { iso:"ISO 10816-3", freq_sampling: ">= 10 kHz" } },
        { id: 8002, name: "Termograf√≠a Infrarroja (Hotspots)", initial:"Detecci√≥n de sobrecalentamiento en componentes.", modelosAplicables:["Sistemas el√©ctricos, mec√°nicos, hidr√°ulicos"], symptoms:["Puntos calientes (Hotspots) detectables IR"], causes:["Conexiones el√©ctricas flojas", "Desbalanceo de fases", "Falla incipiente en rodamientos", "V√°lvulas hidr√°ulicas obstruidas"], diagnosticSteps:["1. Escaneo termografico (comparar con baseline).", "2. Medici√≥n de gradientes de temperatura.", "3. Inspecci√≥n visual del componente."], solution:["Apretar conexiones", "Equilibrar fases", "Reemplazar rodamientos", "Limpieza/Reemplazo v√°lvulas"], costoEstimado:"N/A (Metodolog√≠a)", searchTerms:"termografia infrarroja diagnostico hotspots", codes:[], diagnosticTechnique:{ description: "Criterios de Alarma (Delta T):", code:`Diferencia de temperatura > 15¬∞C respecto a componentes similares o baseline es cr√≠tica.\nUsar an√°lisis termogr√°fico comparativo (Delta T) y absoluto.`} },
        { id: 9001, name: "An√°lisis de Aceite (Tribolog√≠a)", initial:"Part√≠culas de desgaste elevadas, contaminaci√≥n, degradaci√≥n.", modelosAplicables:["Aceites motor/hidr√°ulico/transmisi√≥n"], symptoms:["Aumento Fe, Si, Al, Cr en ppm", "Viscosidad fuera de rango", "Alto N√∫mero √Åcido (TAN)", "Presencia Agua/Combustible"], causes:["Desgaste rodamientos/engranajes", "Contaminaci√≥n abrasiva (Si/Al)", "Contaminaci√≥n por agua/combustible", "Oxidaci√≥n/degradaci√≥n aditivos"], diagnosticSteps:["1. Espectrometr√≠a de emisi√≥n at√≥mica (ICP/OES).", "2. Viscosidad cinem√°tica (40¬∞C/100¬∞C).", "3. N√∫mero √Åcido Total (TAN) / N√∫mero B√°sico Total (TBN).", "4. Ferrograf√≠a Anal√≠tica (morfolog√≠a part√≠culas).", "5. Conteo de part√≠culas (ISO 4406)."], solution:["Filtrado avanzado (ri√±√≥n)", "Cambio aceite", "Investigaci√≥n origen part√≠culas", "Reemplazo filtros", "Reparaci√≥n sellos"], costoEstimado:"N/A (Metodolog√≠a)", searchTerms:"analisis aceite ppm desgaste contaminacion ferrografia", codes:[], diagnosticTechnique:{ description: "L√≠mites de Alarma T√≠picos (ppm) y Est√°ndares:", code:`L√≠mites cr√≠ticos (ppm) var√≠an por compartimento: Fe > 50-200 (motor), Si > 20 (alerta contaminaci√≥n).\nClasificaci√≥n ISO 4406 limpieza (Objetivo: 18/16/13 o menor para hidr√°ulico).\nVerificar si la diluci√≥n por combustible es mayor al 2%.`} }
    ]
};

// --- BASE DE DATOS 3: BIBLIOTECA (De Don_Piston_Proyecto.txt) ---
const db_videos = [
    { title: "Formaci√≥n de T√©cnico de Maquinaria Pesada", url: "https://www.youtube.com/embed/BDOqZ2tT5Fs", desc: "Explica lo que implica aprender el oficio de mec√°nico de maquinaria pesada.", img: "https://img.youtube.com/vi/BDOqZ2tT5Fs/0.jpg" },
    { title: "Reparaciones Reales en Campo (Service Call #61)", url: "https://www.youtube.com/embed/i-rOPrysBkM", desc: "Reparaciones reales en campo, con excavadoras, ejes rotos, etc.", img: "https://img.youtube.com/vi/i-rOPrysBkM/0.jpg" },
    { title: "Tips y Trucos para Reparaci√≥n", url: "https://www.youtube.com/embed/8WC3tr1Lo-U", desc: "Consejos de mantenimiento general para maquinaria pesada.", img: "https://img.youtube.com/vi/8WC3tr1Lo-U/0.jpg" },
    { title: "Tutorial: Engrase y Aceitado de Maquinaria", url: "https://www.youtube.com/embed/o7cCcDcTurs", desc: "Mantenimiento b√°sico: engrase, engrasadores, etc.", img: "https://img.youtube.com/vi/o7cCcDcTurs/0.jpg" },
    { title: "Gu√≠a de Primeras Herramientas (Mec√°nico Pesado)", url: "https://www.youtube.com/embed/zerPj6JX2fY", desc: "Ideal para estudiantes o gente que est√° empezando.", img: "https://img.youtube.com/vi/zerPj6JX2fY/0.jpg" },
    { title: "Servicio de Excavadora de 250 Horas", url: "https://www.youtube.com/embed/QNzaDCCyTGE", desc: "Un servicio de excavadora de 250 horas, bastante especializado.", img: "https://img.youtube.com/vi/QNzaDCCyTGE/0.jpg" },
    { title: "Reparaci√≥n Cilindros CAT 992K Gigante", url: "https://www.youtube.com/embed/bl3WwrUTB8M", desc: "Reparaci√≥n avanzada de cilindros hidr√°ulicos en maquinaria gigante.", img: "https://img.youtube.com/vi/bl3WwrUTB8M/0.jpg" },
    { title: "Reparaciones en la Lluvia (Service Call #68)", url: "https://www.youtube.com/embed/C7hloLZ1KT0", desc: "Muestra la realidad del trabajo de campo bajo condiciones duras (lluvia, barro).", img: "https://img.youtube.com/vi/C7hloLZ1KT0/0.jpg" }
];

const db_foros = [
    { title: "¬øC√≥mo entraste al mundo de la maquinaria pesada?", url: "https://www.reddit.com/r/heavyequipment/comments/1dxbqdd/how_did_you_get_into_heavy_equipment/", desc: "Un mec√°nico comenta su transici√≥n al rubro." },
    { title: "¬øQui√©n hace el Mantenimiento Diario?", url: "https://www.reddit.com/r/heavyequipment/comments/1k1pkhn/a_question_on_who_does_the_daily_maintenance_on/", desc: "√ötil para ver tareas reales de mantenimiento diario." },
    { title: "T√©cnico Di√©sel vs. Maquinaria Pesada", url: "https://www.reddit.com/r/DieselTechs/comments/142jxi5/diesel_tech_vs_heavy_equipment/", desc: "Comparaci√≥n entre mec√°nica di√©sel y maquinaria pesada." },
    { title: "¬øVale la pena ser t√©cnico de maquinaria pesada?", url: "https://www.reddit.com/r/heavyequipment/comments/z6ezoi/is_it_worth_being_a_heavy_equipment_technician/", desc: "La parte de estilo de vida/trabajo duro." },
    { title: "Experiencias de campo", url: "https://www.reddit.com/r/DieselTechs/comments/1bci2dl/heavy_equipment_mechanic/", desc: "Historias reales y consejos de veteranos." },
    { title: "Foro Principal: HeavyEquipmentForums", url: "https://www.heavyequipmentforums.com", desc: "La comunidad t√©cnica m√°s grande, con miles de hilos para mec√°nicos." }
];


/* ========================================================================= */
/* L√ìGICA DE LA APLICACI√ìN                                                   */
/* ========================================================================= */

document.addEventListener('DOMContentLoaded', () => {

    // --- L√≥gica de Pesta√±as (Tabs) ---
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabName = button.dataset.tab;

            // Ocultar todo
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            // Mostrar el activo
            button.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        });
    });

    // --- L√≥gica del Chatbot (Don Buenaventura) ---
    const chatLog = document.getElementById('chat-log');
    const chatForm = document.getElementById('chat-input-form');
    const chatInput = document.getElementById('chat-input');

    chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const userQuery = chatInput.value.trim();
        if (userQuery === "") return;

        appendMessage('user', userQuery);
        chatInput.value = "";

        // Simular respuesta del bot
        setTimeout(() => {
            const botResponse = findBotResponse(userQuery);
            appendMessage('bot', botResponse);
        }, 500);
    });

    function appendMessage(sender, text) {
        const icon = sender === 'bot' ? 'B' : '<i class="fas fa-user"></i>';
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}`;
        messageDiv.innerHTML = `
            <div class="icon">${icon}</div>
            <div class="text-bubble">${text}</div>
        `;
        chatLog.appendChild(messageDiv);
        chatLog.scrollTop = chatLog.scrollHeight; // Auto-scroll
    }

    function findBotResponse(query) {
        const lowerQuery = query.toLowerCase();
        
        // Frases gen√©ricas de Don Buenaventura
        const frasesIntro = [
            "Mire, compadre, eso me suena a...",
            "A ver, parcero, d√©jeme pensar...",
            "Cl√°sico problema, viejo. Lo que pasa es que...",
            "Echale ojo a esto que te voy a decir...",
            "Uy, esa falla es complicada pero tiene ma√±a..."
        ];
        const frasesFallo = [
            "La verdad, de eso s√≠ que no s√©. ¬øSeguro que no es un problema el√©ctrico?",
            "Me corchaste, mijo. Mejor revisa el manual t√©cnico.",
            "Ni idea, parcero. ¬øYa revisaste si tiene gasolina? Je, je. Ahora en serio, mejor busca en Google o en el manual."
        ];

        let bestMatch = null;
        let maxMatchCount = 0;

        // Buscar en la base de datos de preguntas y respuestas
        for (const item of db_preguntas_respuestas) {
            let matchCount = 0;
            for (const keyword of item.keywords) {
                if (lowerQuery.includes(keyword)) {
                    matchCount++;
                }
            }
            if (matchCount > maxMatchCount) {
                maxMatchCount = matchCount;
                bestMatch = item.respuesta;
            }
        }

        if (bestMatch) {
            const randomIntro = frasesIntro[Math.floor(Math.random() * frasesIntro.length)];
            return `${randomIntro}<br><br><strong>${bestMatch}</strong>`;
        } else {
            const randomFallback = frasesFallo[Math.floor(Math.random() * frasesFallo.length)];
            return randomFallback;
        }
    }

    // --- L√≥gica del Manual (Basada en gemini.txt) ---
    const manualWindow = document.getElementById('manual-window');
    const machineTypeSection = manualWindow.querySelector('#machineTypeSection');
    const brandModelSection = manualWindow.querySelector('#brandModelSection');
    const failureSection = manualWindow.querySelector('#failureSection');
    const diagnosisArea = manualWindow.querySelector('#diagnosisArea');
    const machineTypesGrid = manualWindow.querySelector('#machineTypesGrid');
    const brandsGrid = manualWindow.querySelector('#brandsGrid');
    const failuresList = manualWindow.querySelector('#failuresList');
    const filterInput = manualWindow.querySelector('#filterInput');
    const diagnosisResult = manualWindow.querySelector('#diagnosisResult');
    const diagnosisTitle = manualWindow.querySelector('#diagnosisTitle');
    const backToTypesBtn = manualWindow.querySelector('#backToTypesBtn');
    const backToBrandsBtn = manualWindow.querySelector('#backToBrandsBtn');
    const backToFailuresBtn = manualWindow.querySelector('#backToFailuresBtn');
    const btnOpenGoogleDiag = manualWindow.querySelector('#btnOpenGoogleDiag');
    const btnReset = manualWindow.querySelector('#btnReset');

    let selectedMachineType = null;
    let selectedBrandModelKey = null;

    function renderManualIcon(iconHtmlOrEmoji) {
        if (typeof iconHtmlOrEmoji === 'string' && iconHtmlOrEmoji.startsWith('<i')) {
            return iconHtmlOrEmoji;
        }
        return `<span class="icon">${iconHtmlOrEmoji || '‚ùì'}</span>`;
    }

    function initMachineTypes() {
        machineTypesGrid.innerHTML = '';
        Object.keys(machineTypes).sort((a,b) => machineTypes[a].name.localeCompare(machineTypes[b].name)).forEach(key => {
            const type = machineTypes[key];
            const card = document.createElement('div');
            card.className = 'selection-card';
            card.innerHTML = `${renderManualIcon(type.icon)}<strong>${type.name}</strong><div class="description">${type.description || ''}</div>`;
            card.onclick = () => showBrands(key);
            machineTypesGrid.appendChild(card);
        });
    }

    function showBrands(typeKey) {
        selectedMachineType = typeKey;
        brandsGrid.innerHTML = '';
        const brands = brandsAndModels[typeKey] || [];
        if (brands.length === 0) {
            brandsGrid.innerHTML = `<p class="no-failures">A√∫n no hay marcas/modelos definidos para ${machineTypes[typeKey]?.name || typeKey}.</p>`;
        } else {
            brands.sort((a,b) => a.name.localeCompare(b.name)).forEach(brand => {
                const card = document.createElement('div');
                card.className = 'selection-card';
                const modelsText = (brand.models && Array.isArray(brand.models)) ? `<div class="description">${brand.models.join(' / ')}</div>` : '';
                card.innerHTML = `${renderManualIcon(brand.icon || machineTypes[typeKey]?.icon)}<strong>${brand.name}</strong>${modelsText}`;
                card.onclick = () => selectBrandModel(brand.key);
                brandsGrid.appendChild(card);
            });
        }
        machineTypeSection.classList.add('hidden');
        brandModelSection.classList.remove('hidden');
        failureSection.classList.add('hidden');
        diagnosisArea.classList.add('hidden');
    }

    function selectBrandModel(brandKey) {
        selectedBrandModelKey = brandKey;
        filterInput.value = '';
        renderFailuresList(brandKey, '');
        brandModelSection.classList.add('hidden');
        failureSection.classList.remove('hidden');
        diagnosisArea.classList.add('hidden');
    }

    function renderFailuresList(brandKey, filterText = '') {
        failuresList.innerHTML = '';
        const modelFailures = Array.isArray(failures[brandKey]) ? failures[brandKey] : [];
        const lowerFilterText = filterText.toLowerCase().trim();
        
        const filteredFailures = modelFailures.filter(f => {
            if (!f || typeof f !== 'object') return false;
            if (!lowerFilterText) return true;
            const searchableText = [
                f.name, f.initial, f.searchTerms,
                ...(f.symptoms || []), ...(f.modelosAplicables || []), ...(f.codes || []),
                ...(f.causes || []), ...(f.solution || []), ...(f.prevention || []), f.datoIngeniero,
            ].filter(item => typeof item === 'string').join(' ').toLowerCase();
            return searchableText.includes(lowerFilterText);
        });

        if (filteredFailures.length === 0) {
            let brandName = 'este modelo/m√©todo';
            const brandData = (brandsAndModels[selectedMachineType] || []).find(b => b.key === brandKey);
            if (brandData) brandName = brandData.name;
            failuresList.innerHTML = `<p class="no-failures">${filterText ?
                'No se encontraron fallas con ese filtro.' : `A√∫n no hay fallas definidas para ${brandName}.`}</p>`;
        } else {
            filteredFailures.sort((a,b) => (a.name || '').localeCompare(b.name || '')).forEach(f => {
                const btn = document.createElement('button');
                btn.className = 'failure-btn';
                const modelsText = (f.modelosAplicables && Array.isArray(f.modelosAplicables)) ? `<div class="models">Modelos: ${f.modelosAplicables.join(', ')}</div>` : '';
                const initialText = f.initial || 'Contexto no especificado.';
                btn.innerHTML = `<strong>${f.name || 'Falla sin nombre'}</strong><div class="initial-context">${initialText}</div>${modelsText}`;
                btn.onclick = () => showDiagnosis(f);
                failuresList.appendChild(btn);
            });
        }
    }

    filterInput.addEventListener('input', (e) => {
        if (selectedBrandModelKey) {
            renderFailuresList(selectedBrandModelKey, e.target.value);
        }
    });

    const renderList = (items, type = 'ul') => {
        if (!items || (Array.isArray(items) && items.length === 0)) return '<p>Informaci√≥n no disponible.</p>';
        if (typeof items === 'string') return `<p>${items}</p>`;
        if (Array.isArray(items)) {
            const listItems = items.filter(item => item != null && String(item).trim() !== '').map(item => `<li>${String(item)}</li>`).join('');
            if (!listItems) return '<p>Informaci√≥n no disponible.</p>';
            return type === 'ol' ? `<ol>${listItems}</ol>` : `<ul>${listItems}</ul>`;
        }
        return '<p>Formato de datos no reconocido.</p>';
    };
    const renderCodes = (codes) => {
        if (!Array.isArray(codes) || codes.length === 0) return '';
        const codeItems = codes.filter(c => c != null && String(c).trim() !== '').map(c => `<code>${String(c)}</code>`).join(' ');
         if (!codeItems) return '';
        return `<div class="info-card codes-list"><h4><i class="fas fa-laptop-code"></i> C√≥digos Error Comunes</h4><p>${codeItems}</p></div>`;
    };
    const renderAdvanced = (items) => {
        if (!items) return '';
        let content = '';
        if (typeof items === 'string') { content = `<p>${items}</p>`; }
        else if (Array.isArray(items) && items.length > 0) { content = renderList(items, 'ol'); }
        else if (typeof items === 'object' && items !== null && items.code !== undefined) { content = `${items.description ? `<p>${items.description}</p>` : ''}<pre><code>${items.code}</code></pre>`; }
        else { return ''; }
        return `<div class="info-card advanced-card"><h4><i class="fas fa-microscope"></i> Diagn√≥stico Avanzado / T√©cnico</h4>${content}</div>`;
    };
    const renderSpecs = (specs) => {
         if (!specs) return '';
         let content = '';
         if(typeof specs === 'string') { content = `<p>${specs}</p>`; }
         else if (Array.isArray(specs) && specs.length > 0) { content = renderList(specs); }
         else if (typeof specs === 'object' && specs !== null && Object.keys(specs).length > 0) {
             content = '<ul>';
             for (const key in specs) {
                 const formattedKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()).replace(/_/g, ' ');
                 content += `<li><strong>${formattedKey}:</strong> ${specs[key]}</li>`;
             }
             content += '</ul>';
         }
         if (!content || content === '<ul></ul>') return '';
         return `<div class="info-card specs-card"><h4><i class="fas fa-ruler-combined"></i> Especificaciones T√©cnicas</h4>${content}</div>`;
    };
    const renderAtacama = (notes) => {
        if (!notes) return '';
         return `<div class="info-card atacama-note"><h4><i class="fas fa-mountain-sun"></i> Notas Espec√≠ficas Atacama</h4>${renderList(notes)}</div>`;
    }

    function showDiagnosis(f) {
        if (!f || typeof f !== 'object') return;
        diagnosisArea.classList.remove('hidden');
        failureSection.classList.add('hidden');
        diagnosisTitle.innerHTML = `<i class="fas fa-clipboard-list section-icon"></i> Diagn√≥stico: ${f.name || 'Detalle de Falla'}`;
        diagnosisResult.innerHTML = `
            ${(f.modelosAplicables && Array.isArray(f.modelosAplicables)) ?
            `<p class="model-info">Modelos: ${f.modelosAplicables.join(', ')}</p>`: ''}
            ${f.alertaSeguridad ? `<div class="alert-safety info-card"><h4><i class="fas fa-triangle-exclamation"></i> ALERTA SEGURIDAD</h4><p>${f.alertaSeguridad || 'N/A'}</p></div>` : ''}
            <div class="info-card"><h4><i class="fas fa-eye"></i> S√≠ntomas</h4>${renderList(f.symptoms)}<p style="margin-top:15px;"><strong>Contexto:</strong> ${f.initial || 'N/A'}</p></div>
            <div class="info-card"><h4><i class="fas fa-project-diagram"></i> Causas Probables</h4>${renderList(f.causes)}</div>
            <div class="info-card"><h4><i class="fas fa-stethoscope"></i> Pasos de Diagn√≥stico</h4>${renderList(f.diagnosticSteps, 'ol')}</div>
            ${renderAdvanced(f.diagnosticAdvanced || f.diagnosticTechnique)}
            <div class="info-card"><h4><i class="fas fa-wrench"></i> Soluciones Recomendadas</h4>${renderList(f.solution)}</div>
            ${renderAdvanced(f.solutionAdvanced)}
            <div class="info-card gestion-card"><h4><i class="fas fa-tasks"></i> Gesti√≥n (Estimados)</h4><p><strong>Costo Estimado:</strong> ${f.costoEstimado || 'Variable'}</p>${f.tiempoDowntime ? `<p><strong>Tiempo Inactividad (Downtime):</strong> ${f.tiempoDowntime}</p>` : ''}</div>
            ${renderSpecs(f.specs)}
            ${renderCodes(f.codes)}
            ${renderAtacama(f.atacamaNotes)}
            ${f.datoIngeniero || f.prevention ? `<div class="info-card alert-engineer"><h4><i class="fas ${f.prevention ? 'fa-shield-alt' : 'fa-lightbulb'}"></i> ${f.prevention ? 'Prevenci√≥n' : 'Dato T√©cnico'}</h4>${f.datoIngeniero ? `<p>${f.datoIngeniero}</p>` : ''}${f.prevention ? renderList(f.prevention) : ''}</div>` : ''}
        `;
        const searchTerm = (typeof f.searchTerms === 'string' ? f.searchTerms : f.name) || '';
        const q = encodeURIComponent(searchTerm);
        let brandModelName = '';
        if (selectedMachineType && selectedBrandModelKey) {
            const brandData = (brandsAndModels[selectedMachineType] || []).find(b => b.key === selectedBrandModelKey);
            brandModelName = brandData ? brandData.name : '';
        }
        btnOpenGoogleDiag.href = `https://www.google.com/search?q=${q}+${encodeURIComponent(brandModelName)}`;
    }
    
    // Listeners de botones del Manual
    backToTypesBtn.addEventListener('click', () => {
        brandModelSection.classList.add('hidden');
        machineTypeSection.classList.remove('hidden');
        selectedBrandModelKey = null;
    });
    backToBrandsBtn.addEventListener('click', () => {
        failureSection.classList.add('hidden');
        brandModelSection.classList.remove('hidden');
    });
    backToFailuresBtn.addEventListener('click', () => {
        diagnosisArea.classList.add('hidden');
        failureSection.classList.remove('hidden');
    });
    btnReset.addEventListener('click', () => {
        brandModelSection.classList.add('hidden');
        failureSection.classList.add('hidden');
        diagnosisArea.classList.add('hidden');
        machineTypeSection.classList.remove('hidden');
        selectedMachineType = null;
        selectedBrandModelKey = null;
        filterInput.value = '';
        window.scrollTo({top: 0, behavior:'smooth'});
    });
    
    // Iniciar el Manual
    initMachineTypes();

    // --- L√≥gica de la Biblioteca ---
    const videoList = document.getElementById('video-list');
    const forumList = document.getElementById('forum-list');

    db_videos.forEach(video => {
        const card = document.createElement('div');
        card.className = 'resource-card';
        card.innerHTML = `
            <a href="${video.url.replace('embed/', 'watch?v=')}" target="_blank">
                <img src="${video.img}" alt="${video.title}">
            </a>
            <div class="resource-card-content">
                <h4>${video.title}</h4>
                <p>${video.desc}</p>
                <a href="${video.url.replace('embed/', 'watch?v=')}" target="_blank">Ver Video <i class="fas fa-external-link-alt"></i></a>
            </div>
        `;
        videoList.appendChild(card);
    });

    db_foros.forEach(forum => {
        const card = document.createElement('div');
        card.className = 'resource-card';
        card.innerHTML = `
            <div class="resource-card-content">
                <h4>${forum.title}</h4>
                <p>${forum.desc}</p>
                <a href="${forum.url}" target="_blank">Leer Hilo <i class="fas fa-external-link-alt"></i></a>
            </div>
        `;
        forumList.appendChild(card);
    });
});
</script>
</body>
</html>
